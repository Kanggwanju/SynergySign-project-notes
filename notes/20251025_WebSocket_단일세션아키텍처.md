# ë‹¨ì¼ ì„¸ì…˜ WebSocket ì•„í‚¤í…ì²˜ ì„¤ê³„ ë¬¸ì„œ

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [ê¸°ìˆ ì  ì´ì ](#ê¸°ìˆ ì -ì´ì )
4. [í”„ë¡ íŠ¸ì—”ë“œ ì—°ê´€ì„±](#í”„ë¡ íŠ¸ì—”ë“œ-ì—°ê´€ì„±)
5. [ë©´ì ‘ ëŒ€ë¹„ í•µì‹¬ ë‹µë³€](#ë©´ì ‘-ëŒ€ë¹„-í•µì‹¬-ë‹µë³€)

---

## ê°œìš”

### ë‹¨ì¼ ì„¸ì…˜ì´ë€?
**í•œ ì‚¬ìš©ìë‹¹ í•˜ë‚˜ì˜ í™œì„± WebSocket ì—°ê²°ë§Œ í—ˆìš©í•˜ëŠ” ì •ì±…**ì…ë‹ˆë‹¤. ë™ì¼ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ë¸Œë¼ìš°ì € íƒ­ì´ë‚˜ ì°½ì—ì„œ ë™ì‹œì— ì ‘ì†ì„ ì‹œë„í•˜ë©´, **ë¨¼ì € ì—°ê²°ëœ ì„¸ì…˜ì„ ë³´í˜¸í•˜ê³  ìƒˆë¡œìš´ ì—°ê²° ì‹œë„ë¥¼ ì°¨ë‹¨**í•©ë‹ˆë‹¤. ì´ëŠ” "First-Come, First-Served" ì›ì¹™ìœ¼ë¡œ, ê¸°ì¡´ ì‚¬ìš©ìì˜ ê²Œì„ ê²½í—˜ì„ ë³´í˜¸í•˜ëŠ” ê²ƒì„ ìµœìš°ì„ ìœ¼ë¡œ í•©ë‹ˆë‹¤.

### êµ¬í˜„ ìœ„ì¹˜
- **ë°±ì—”ë“œ**: Spring Boot + STOMP over WebSocket
- **í•µì‹¬ ì»´í¬ë„ŒíŠ¸**:
  - `SingleSessionChannelInterceptor`: CONNECT/SUBSCRIBE ë‹¨ê³„ì—ì„œ ì¤‘ë³µ ì„¸ì…˜ ì°¨ë‹¨
  - `UserSessionRegistry`: ì‚¬ìš©ìë³„ í™œì„± ì„¸ì…˜ ID ë§¤í•‘ ê´€ë¦¬ (ConcurrentHashMap ê¸°ë°˜)
  - `WebSocketSessionService`: ì„¸ì…˜ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬ ë° ìë™ í‡´ì¥ ì²˜ë¦¬

---

## ì•„í‚¤í…ì²˜ ì„¤ê³„

### 1. ì„¸ì…˜ ê´€ë¦¬ íë¦„ (First-Come, First-Served)

```
[ì‹œê°„ T1] í´ë¼ì´ì–¸íŠ¸ A - íƒ­1 â”€â”€CONNECTâ”€â”€> [ë°±ì—”ë“œ]
                                           â”‚
                                           â”œâ”€ ì¸ì¦ í™•ì¸ âœ“
                                           â”œâ”€ ì¤‘ë³µ ì„¸ì…˜ í™•ì¸ (ì—†ìŒ)
                                           â”œâ”€ UserSessionRegistry.bind(userId, sessionId1)
                                           â””â”€ ì—°ê²° í—ˆìš© âœ“
                                           
[ì‹œê°„ T2] í´ë¼ì´ì–¸íŠ¸ A - íƒ­1: ê²Œì„ ì§„í–‰ ì¤‘... (í™œì„± ìƒíƒœ ìœ ì§€)

[ì‹œê°„ T3] í´ë¼ì´ì–¸íŠ¸ A - íƒ­2 â”€â”€CONNECTâ”€â”€> [ë°±ì—”ë“œ]
                                           â”‚
                                           â”œâ”€ ì¸ì¦ í™•ì¸ âœ“
                                           â”œâ”€ ì¤‘ë³µ ì„¸ì…˜ í™•ì¸ (sessionId1 ì´ë¯¸ ì¡´ì¬!)
                                           â”œâ”€ ê¸°ì¡´ ì„¸ì…˜ ë³´í˜¸ (íƒ­1 ì—°ê²° ìœ ì§€)
                                           â”œâ”€ DUPLICATE_SESSION ì—ëŸ¬ ë°˜í™˜ âœ—
                                           â””â”€ ìƒˆë¡œìš´ ì—°ê²° ì°¨ë‹¨ âœ—

ê²°ê³¼: íƒ­1ì˜ ê²Œì„ ê²½í—˜ì€ ì¤‘ë‹¨ ì—†ì´ ê³„ì† ìœ ì§€ë¨
```

**í•µì‹¬ ì›ì¹™**: ë¨¼ì € ì—°ê²°ëœ ì‚¬ìš©ìì˜ ê²Œì„ ê²½í—˜ì„ ë³´í˜¸í•˜ëŠ” ê²ƒì´ ìµœìš°ì„ 

### 2. í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì—­í• 

#### SingleSessionChannelInterceptor
```java
@Override
public Message<?> preSend(Message<?> message, MessageChannel channel) {
    switch (command) {
        case CONNECT -> {
            // 1. ì¸ì¦ í™•ì¸
            if (accessor.getUser() == null) {
                throw new MessagingException("ì¸ì¦ë˜ì§€ ì•Šì€ CONNECT ìš”ì²­");
            }
            
            // 2. ê¸°ì¡´ í™œì„± ì„¸ì…˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ (First-Come, First-Served)
            if (userSessionRegistry.hasOtherActiveSession(userId, sessionId)) {
                // ê¸°ì¡´ ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìƒˆë¡œìš´ ì—°ê²° ì‹œë„ë¥¼ ì°¨ë‹¨
                // â†’ ë¨¼ì € ì—°ê²°ëœ ì‚¬ìš©ìì˜ ê²Œì„ ê²½í—˜ ë³´í˜¸
                throw new MessagingException("DUPLICATE_SESSION: ì´ë¯¸ ë‹¤ë¥¸ ì„¸ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤");
            }
            
            // 3. ì¤‘ë³µ ì„¸ì…˜ì´ ì—†ì„ ë•Œë§Œ ìƒˆ ì„¸ì…˜ ë“±ë¡
            userSessionRegistry.bind(userId, sessionId);
            log.info("CONNECT í—ˆìš© - userId: {}, sessionId: {}", userId, sessionId);
        }
        case SUBSCRIBE -> {
            // í™œì„± ì„¸ì…˜ì—ì„œë§Œ êµ¬ë… í—ˆìš©
            if (!userSessionRegistry.isActive(userId, sessionId)) {
                throw new MessagingException("ë¹„í™œì„± ì„¸ì…˜ì—ì„œì˜ SUBSCRIBE ìš”ì²­");
            }
        }
    }
}
```

#### UserSessionRegistry
```java
@Component
public class UserSessionRegistry {
    // ì‚¬ìš©ìë³„ í™œì„± ì„¸ì…˜ ID ë§¤í•‘ (Thread-safe)
    private final Map<Long, String> userToSession = new ConcurrentHashMap<>();
    
    public void bind(Long userId, String sessionId) {
        // ì²« ë²ˆì§¸ ì„¸ì…˜ë§Œ ë“±ë¡ (ì´ë¯¸ ìˆìœ¼ë©´ ë“±ë¡ë˜ì§€ ì•ŠìŒ)
        userToSession.put(userId, sessionId);
    }
    
    public boolean hasOtherActiveSession(Long userId, String sessionId) {
        String current = userToSession.get(userId);
        // ì´ë¯¸ ë‹¤ë¥¸ ì„¸ì…˜ì´ ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´ true ë°˜í™˜
        // â†’ ìƒˆë¡œìš´ ì—°ê²° ì‹œë„ë¥¼ ì°¨ë‹¨í•˜ëŠ” ê·¼ê±°
        return current != null && !current.equals(sessionId);
    }
    
    public void unbind(Long userId, String sessionId) {
        String current = userToSession.get(userId);
        // í˜„ì¬ ë“±ë¡ëœ ì„¸ì…˜ê³¼ ì¼ì¹˜í•  ë•Œë§Œ ì œê±°
        // â†’ ì˜ëª»ëœ ì„¸ì…˜ì´ ì •ìƒ ì„¸ì…˜ì„ ì œê±°í•˜ëŠ” ê²ƒ ë°©ì§€
        if (current != null && current.equals(sessionId)) {
            userToSession.remove(userId);
        }
    }
}
```

### 3. ìë™ í‡´ì¥ ì²˜ë¦¬ ë©”ì»¤ë‹ˆì¦˜

```
[í´ë¼ì´ì–¸íŠ¸] â”€â”€DISCONNECTâ”€â”€> [WebSocketEventsListener]
                                    â”‚
                                    â”œâ”€ ì„¸ì…˜ ID, ì‚¬ìš©ì ID ì¶”ì¶œ
                                    â””â”€> [WebSocketSessionService]
                                            â”‚
                                            â”œâ”€ 1. í™œì„± ì„¸ì…˜ ê²€ì¦
                                            â”œâ”€ 2. ê²Œì„ë°© ìë™ í‡´ì¥ ì²˜ë¦¬
                                            â”œâ”€ 3. ë‹¤ë¥¸ ì°¸ê°€ìì—ê²Œ í‡´ì¥ ì•Œë¦¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸
                                            â””â”€ 4. UserSessionRegistry.unbind()
```

---

## ê¸°ìˆ ì  ì´ì 

### 1. ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

**ë¬¸ì œ ìƒí™© (ë‹¤ì¤‘ ì„¸ì…˜ í—ˆìš© ì‹œ)**:
```
íƒ­1: ê²Œì„ë°© A ì…ì¥ â†’ ì°¸ê°€ì ëª©ë¡ì— "ì‚¬ìš©ìA" ì¶”ê°€
íƒ­2: ê²Œì„ë°© B ì…ì¥ â†’ ì°¸ê°€ì ëª©ë¡ì— "ì‚¬ìš©ìA" ì¶”ê°€
ê²°ê³¼: ì‚¬ìš©ìAê°€ ë‘ ë°©ì— ë™ì‹œ ì¡´ì¬ (ë°ì´í„° ë¶ˆì¼ì¹˜!)
```

**ë‹¨ì¼ ì„¸ì…˜ í•´ê²° (First-Come, First-Served)**:
```
[T1] íƒ­1: WebSocket ì—°ê²° ì„±ê³µ âœ“
[T2] íƒ­1: ê²Œì„ë°© A ì…ì¥ âœ“ (ì°¸ê°€ì ëª©ë¡ì— "ì‚¬ìš©ìA" ì¶”ê°€)
[T3] íƒ­2: WebSocket ì—°ê²° ì‹œë„ â†’ DUPLICATE_SESSION ì—ëŸ¬ â†’ ì°¨ë‹¨ âœ—
     â†’ íƒ­1ì˜ ê²Œì„ ì§„í–‰ì€ ì „í˜€ ì˜í–¥ë°›ì§€ ì•ŠìŒ
ê²°ê³¼: ì‚¬ìš©ìAëŠ” í•­ìƒ í•˜ë‚˜ì˜ ë°©ì—ë§Œ ì¡´ì¬ (ì¼ê´€ì„± ìœ ì§€!)
```

**í•µì‹¬**: ë¨¼ì € ì—°ê²°ëœ ì„¸ì…˜ì„ ë³´í˜¸í•¨ìœ¼ë¡œì¨, ê²Œì„ ì¤‘ì¸ ì‚¬ìš©ìì˜ ê²½í—˜ì´ ì¤‘ë‹¨ë˜ì§€ ì•ŠìŒ

### 2. ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±

| í•­ëª© | ë‹¤ì¤‘ ì„¸ì…˜ | ë‹¨ì¼ ì„¸ì…˜ |
|------|----------|----------|
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | ì‚¬ìš©ìë‹¹ Nê°œ ì„¸ì…˜ | ì‚¬ìš©ìë‹¹ 1ê°œ ì„¸ì…˜ |
| ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ | Në°° ë©”ì‹œì§€ ì „ì†¡ | 1ë°° ë©”ì‹œì§€ ì „ì†¡ |
| ì„œë²„ ë¶€í•˜ | ë†’ìŒ | ë‚®ìŒ |

**ì˜ˆì‹œ**: 100ëª… ì‚¬ìš©ìê°€ í‰ê·  3ê°œ íƒ­ ì‚¬ìš© ì‹œ
- ë‹¤ì¤‘ ì„¸ì…˜: 300ê°œ WebSocket ì—°ê²° ê´€ë¦¬
- ë‹¨ì¼ ì„¸ì…˜: 100ê°œ WebSocket ì—°ê²° ê´€ë¦¬ (66% ì ˆê°)

### 3. ë³´ì•ˆ ê°•í™”

#### ì„¸ì…˜ í•˜ì´ì¬í‚¹ ë°©ì§€ (First-Come, First-Served ë³´í˜¸)
```java
// ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ + ë‹¨ì¼ ì„¸ì…˜ ì •ì±…
@Component
public class CookieAuthHandshakeInterceptor implements HandshakeInterceptor {
    @Override
    public boolean beforeHandshake(ServerHttpRequest request, ...) {
        // 1. ì¿ í‚¤ì—ì„œ JWT í† í° ì¶”ì¶œ
        // 2. í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì¸ì¦
        // 3. SecurityContextì— ì¸ì¦ ì •ë³´ ì €ì¥
        // â†’ ì´í›„ SingleSessionChannelInterceptorì—ì„œ ì¤‘ë³µ ì„¸ì…˜ ì°¨ë‹¨
    }
}
```

**íš¨ê³¼**:
- **ì •ìƒ ì‚¬ìš©ì ë³´í˜¸**: ê³µê²©ìê°€ íƒˆì·¨í•œ í† í°ìœ¼ë¡œ ì ‘ì† ì‹œë„ â†’ ê¸°ì¡´ ì •ìƒ ì„¸ì…˜ì´ ë¨¼ì € ì—°ê²°ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ê³µê²©ìì˜ ì—°ê²° ì°¨ë‹¨
- **ì¦‰ê°ì ì¸ ì´ìƒ ê°ì§€**: ì •ìƒ ì‚¬ìš©ìê°€ ê²Œì„ ì¤‘ì¼ ë•Œ ë‹¤ë¥¸ ê³³ì—ì„œ ì—°ê²° ì‹œë„ ë¡œê·¸ ë°œìƒ â†’ ë³´ì•ˆíŒ€ì´ ì¦‰ì‹œ íƒì§€ ê°€ëŠ¥
- **ì„¸ì…˜ ê³µìœ  ê³µê²© ì›ì²œ ì°¨ë‹¨**: ë™ì‹œ ì ‘ì† ë¶ˆê°€ë¡œ ê³„ì • ê³µìœ  ë¶ˆê°€ëŠ¥

**ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ**:
```
[ì •ìƒ ì‚¬ìš©ì] íƒ­1ì—ì„œ ê²Œì„ ì§„í–‰ ì¤‘ (sessionId: abc123)
[ê³µê²©ì] íƒˆì·¨í•œ í† í°ìœ¼ë¡œ ì—°ê²° ì‹œë„ (sessionId: xyz789)
â†’ ë°±ì—”ë“œ: "ì´ë¯¸ abc123 ì„¸ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆìŒ" â†’ ê³µê²©ì ì°¨ë‹¨
â†’ ì •ìƒ ì‚¬ìš©ìì˜ ê²Œì„ì€ ì¤‘ë‹¨ ì—†ì´ ê³„ì† ì§„í–‰
â†’ ë³´ì•ˆ ë¡œê·¸: "userId=1234ì— ëŒ€í•œ ì¤‘ë³µ ì—°ê²° ì‹œë„ ê°ì§€" ê¸°ë¡
```

### 4. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹¨ìˆœí™”

#### ë°© í‡´ì¥ ì²˜ë¦¬ ì˜ˆì‹œ
```java
// ë‹¤ì¤‘ ì„¸ì…˜ í—ˆìš© ì‹œ (ë³µì¡)
public void leaveRoom(Long userId) {
    // 1. ëª¨ë“  ì„¸ì…˜ì—ì„œ í‡´ì¥ ë©”ì‹œì§€ ì „ì†¡í–ˆëŠ”ì§€ í™•ì¸
    // 2. ë§ˆì§€ë§‰ ì„¸ì…˜ì´ í‡´ì¥í•  ë•Œë§Œ ì‹¤ì œ í‡´ì¥ ì²˜ë¦¬
    // 3. ì„¸ì…˜ë³„ ìƒíƒœ ì¶”ì  í•„ìš”
    // â†’ ë³µì¡í•œ ë™ê¸°í™” ë¡œì§ í•„ìš”
}

// ë‹¨ì¼ ì„¸ì…˜ (ê°„ë‹¨)
public void leaveRoom(Long userId) {
    // 1. í•´ë‹¹ ì‚¬ìš©ì í‡´ì¥ ì²˜ë¦¬
    // 2. ë‹¤ë¥¸ ì°¸ê°€ìì—ê²Œ ì•Œë¦¼
    // â†’ ë‹¨ìˆœí•˜ê³  ëª…í™•í•œ ë¡œì§
}
```

### 5. ì‹¤ì‹œê°„ ìƒíƒœ ë™ê¸°í™” ë¶ˆí•„ìš”

**ë‹¤ì¤‘ ì„¸ì…˜ ì‹œ ë¬¸ì œ**:
```
íƒ­1: ì¤€ë¹„ ì™„ë£Œ ë²„íŠ¼ í´ë¦­
íƒ­2: ì¤€ë¹„ ì™„ë£Œ ìƒíƒœ ë™ê¸°í™” í•„ìš”
íƒ­3: ì¤€ë¹„ ì™„ë£Œ ìƒíƒœ ë™ê¸°í™” í•„ìš”
â†’ ë³µì¡í•œ ìƒíƒœ ë™ê¸°í™” ë¡œì§ í•„ìš”
```

**ë‹¨ì¼ ì„¸ì…˜ í•´ê²°**:
```
íƒ­1: ì¤€ë¹„ ì™„ë£Œ ë²„íŠ¼ í´ë¦­
â†’ ë‹¤ë¥¸ íƒ­ ì—†ìŒ, ë™ê¸°í™” ë¶ˆí•„ìš”
â†’ ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›(Single Source of Truth)
```

---

## í”„ë¡ íŠ¸ì—”ë“œ ì—°ê´€ì„±

### 1. ì‚¬ìš©ì ê²½í—˜(UX) ê°œì„ 

#### ëª…í™•í•œ í”¼ë“œë°± ì œê³µ (ê¸°ì¡´ ì„¸ì…˜ ë³´í˜¸ ì•ˆë‚´)
```javascript
// frontend/src/services/websocket/websocketService.js
onStompError: (frame) => {
    const errorMessage = frame.headers?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
    
    if (errorMessage.includes('DUPLICATE_SESSION')) {
        // ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
        alert('ë‹¤ë¥¸ íƒ­ì´ë‚˜ ì°½ì—ì„œ ì´ë¯¸ ì ‘ì† ì¤‘ì…ë‹ˆë‹¤. ê¸°ì¡´ íƒ­ì„ ë‹«ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        reject(new Error('ì¤‘ë³µ ì„¸ì…˜ ê°ì§€'));
    }
}
```

**íš¨ê³¼**:
- **ëª…í™•í•œ ìƒí™© ì„¤ëª…**: "ì´ë¯¸ ì ‘ì† ì¤‘"ì´ë¼ëŠ” ë©”ì‹œì§€ë¡œ ë¨¼ì € ì—°ê²°ëœ íƒ­ì´ ìˆìŒì„ ì•Œë¦¼
- **êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²•**: "ê¸°ì¡´ íƒ­ì„ ë‹«ìœ¼ì„¸ìš”"ë¼ëŠ” ëª…í™•í•œ ì•¡ì…˜ ê°€ì´ë“œ
- **ê²Œì„ ê²½í—˜ ë³´í˜¸**: ì‹¤ìˆ˜ë¡œ ìƒˆ íƒ­ì„ ì—´ì–´ë„ ì§„í–‰ ì¤‘ì¸ ê²Œì„ì´ ëŠê¸°ì§€ ì•ŠìŒ

**ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤**:
```
1. ì‚¬ìš©ìê°€ íƒ­1ì—ì„œ ê²Œì„ ì§„í–‰ ì¤‘
2. ì‹¤ìˆ˜ë¡œ ìƒˆ íƒ­(íƒ­2)ì„ ì—´ê³  ê°™ì€ í˜ì´ì§€ ì ‘ì† ì‹œë„
3. íƒ­2ì— "ì´ë¯¸ ì ‘ì† ì¤‘ì…ë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ
4. íƒ­1ì˜ ê²Œì„ì€ ì¤‘ë‹¨ ì—†ì´ ê³„ì† ì§„í–‰ âœ“
5. ì‚¬ìš©ìëŠ” íƒ­2ë¥¼ ë‹«ê³  íƒ­1ë¡œ ëŒì•„ê°
```

### 2. ìƒíƒœ ê´€ë¦¬ ë‹¨ìˆœí™”

#### React ìƒíƒœ ê´€ë¦¬ ì˜ˆì‹œ
```javascript
// ë‹¤ì¤‘ ì„¸ì…˜ í—ˆìš© ì‹œ (ë³µì¡)
const [roomState, setRoomState] = useState({
    tab1: { isReady: false, roomId: 1 },
    tab2: { isReady: true, roomId: 2 },
    // íƒ­ë³„ ìƒíƒœ ì¶”ì  í•„ìš”
});

// ë‹¨ì¼ ì„¸ì…˜ (ê°„ë‹¨)
const [roomState, setRoomState] = useState({
    isReady: false,
    roomId: 1
    // ë‹¨ì¼ ìƒíƒœë§Œ ê´€ë¦¬
});
```

### 3. ì‹±ê¸€í†¤ íŒ¨í„´ í™œìš©

```javascript
// frontend/src/services/websocket/websocketService.js
class WebSocketService {
    constructor() {
        this.client = null;  // ë‹¨ì¼ STOMP í´ë¼ì´ì–¸íŠ¸
        this.roomId = null;  // í˜„ì¬ ì°¸ì—¬ ì¤‘ì¸ ë°© ID
    }
    
    connect() {
        // ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ê¸°ì¡´ ì—°ê²° ë°˜í™˜
        if (this.client?.connected) {
            console.log('ì´ë¯¸ WebSocketì— ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
            return Promise.resolve();
        }
        // ìƒˆ ì—°ê²° ìƒì„±
    }
}

// ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ export
export const websocketService = new WebSocketService();
```

**ì´ì **:
- ë°±ì—”ë“œì˜ ë‹¨ì¼ ì„¸ì…˜ ì •ì±…ê³¼ ì™„ë²½í•˜ê²Œ ì¼ì¹˜
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œë„ í•˜ë‚˜ì˜ WebSocket ì¸ìŠ¤í„´ìŠ¤ë§Œ ê´€ë¦¬
- ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì´ê³  ìƒíƒœ ì¶”ì  ìš©ì´

### 4. ìë™ ì •ë¦¬ ë©”ì»¤ë‹ˆì¦˜

```javascript
// ë°© ì¢…ë£Œ ì•Œë¦¼ ìë™ ì²˜ë¦¬
this.client.subscribe('/user/queue/room-closed', (message) => {
    const data = JSON.parse(message.body);
    
    // 1. ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í‘œì‹œ
    alert('ë°©ì¥ì´ ë‚˜ê°€ì„œ ë°©ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    
    // 2. ìë™ìœ¼ë¡œ ë°© ëª©ë¡ í™”ë©´ìœ¼ë¡œ ì´ë™
    navigate('/rooms');
    
    // 3. WebSocket ì—°ê²° ì •ë¦¬
    websocketService.disconnect();
});
```

**íš¨ê³¼**:
- ë°±ì—”ë“œì—ì„œ ì„¸ì…˜ ì •ë¦¬ ì‹œ í”„ë¡ íŠ¸ì—”ë“œë„ ìë™ ì •ë¦¬
- ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨í•  í•„ìš” ì—†ìŒ
- ì¼ê´€ëœ ìƒíƒœ ìœ ì§€

### 5. ì—ëŸ¬ ì²˜ë¦¬ ê°„ì†Œí™”

```javascript
// ë‹¨ì¼ ì„¸ì…˜ ì •ì±…ìœ¼ë¡œ ì—ëŸ¬ ì¼€ì´ìŠ¤ ê°ì†Œ
try {
    await websocketService.connect();
    await websocketService.joinRoom(roomId);
} catch (error) {
    if (error.message.includes('ì¤‘ë³µ ì„¸ì…˜')) {
        // ëª…í™•í•œ ì—ëŸ¬ ì²˜ë¦¬
        showDuplicateSessionError();
    } else {
        // ì¼ë°˜ ì—ëŸ¬ ì²˜ë¦¬
        showGenericError();
    }
}

// ë‹¤ì¤‘ ì„¸ì…˜ í—ˆìš© ì‹œ ê³ ë ¤í•´ì•¼ í•  ì¶”ê°€ ì—ëŸ¬ë“¤:
// - íƒ­ ê°„ ìƒíƒœ ë¶ˆì¼ì¹˜ ì—ëŸ¬
// - ë™ì‹œ ìš”ì²­ ì¶©ëŒ ì—ëŸ¬
// - ì„¸ì…˜ë³„ ê¶Œí•œ ë¶ˆì¼ì¹˜ ì—ëŸ¬
// â†’ ëª¨ë‘ ë¶ˆí•„ìš”!
```

### 6. ì„±ëŠ¥ ìµœì í™”

#### ë¶ˆí•„ìš”í•œ ë Œë”ë§ ë°©ì§€
```javascript
// ë‹¨ì¼ ì„¸ì…˜: í•˜ë‚˜ì˜ ë©”ì‹œì§€ ìŠ¤íŠ¸ë¦¼ë§Œ ì²˜ë¦¬
useEffect(() => {
    websocketService.on('participant', (data) => {
        setParticipants(data.participants);  // 1íšŒ ì—…ë°ì´íŠ¸
    });
}, []);

// ë‹¤ì¤‘ ì„¸ì…˜ í—ˆìš© ì‹œ: ì—¬ëŸ¬ íƒ­ì—ì„œ ì¤‘ë³µ ë©”ì‹œì§€ ìˆ˜ì‹ 
// â†’ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°œìƒ
// â†’ ì„±ëŠ¥ ì €í•˜ ë° ë°°í„°ë¦¬ ì†Œëª¨ ì¦ê°€
```

---

## ë©´ì ‘ ëŒ€ë¹„ í•µì‹¬ ë‹µë³€

### Q1: "ì™œ ë‹¨ì¼ ì„¸ì…˜ ë°©ì‹ì„ ì„ íƒí–ˆë‚˜ìš”?"

**ë‹µë³€ êµ¬ì¡°**: ë¬¸ì œ ì¸ì‹ â†’ í•´ê²° ë°©ë²• â†’ ê¸°ìˆ ì  ì´ì  â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜

> "ì‹¤ì‹œê°„ í€´ì¦ˆ ê²Œì„ì´ë¼ëŠ” ë„ë©”ì¸ íŠ¹ì„±ìƒ, í•œ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì‹œì— ê²Œì„ì— ì°¸ì—¬í•˜ë©´ **ë°ì´í„° ì¼ê´€ì„± ë¬¸ì œ**ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íƒ­1ì—ì„œ ë°© Aì— ì…ì¥í•˜ê³  íƒ­2ì—ì„œ ë°© Bì— ì…ì¥í•˜ë©´, ì„œë²„ ì…ì¥ì—ì„œëŠ” ë™ì¼ ì‚¬ìš©ìê°€ ë‘ ë°©ì— ë™ì‹œ ì¡´ì¬í•˜ëŠ” ëª¨ìˆœì´ ìƒê¹ë‹ˆë‹¤.
>
> ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **First-Come, First-Served ì›ì¹™ì˜ ë‹¨ì¼ ì„¸ì…˜ ì •ì±…**ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤. í•µì‹¬ì€ **ë¨¼ì € ì—°ê²°ëœ ì„¸ì…˜ì„ ë³´í˜¸í•˜ê³ , ìƒˆë¡œìš´ ì—°ê²° ì‹œë„ë¥¼ ì°¨ë‹¨**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. `SingleSessionChannelInterceptor`ì—ì„œ CONNECT ë‹¨ê³„ì— ê¸°ì¡´ í™œì„± ì„¸ì…˜ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ìˆë‹¤ë©´ ìƒˆë¡œìš´ ì—°ê²°ì„ ì¦‰ì‹œ ì°¨ë‹¨í•©ë‹ˆë‹¤. `UserSessionRegistry`ëŠ” ConcurrentHashMapìœ¼ë¡œ ì‚¬ìš©ìë³„ í™œì„± ì„¸ì…˜ì„ Thread-safeí•˜ê²Œ ê´€ë¦¬í•©ë‹ˆë‹¤.
>
> ì´ë¥¼ í†µí•´ ë„¤ ê°€ì§€ í•µì‹¬ ì´ì ì„ ì–»ì—ˆìŠµë‹ˆë‹¤:
> 1. **ê²Œì„ ê²½í—˜ ë³´í˜¸**: ê²Œì„ ì§„í–‰ ì¤‘ì¸ ì‚¬ìš©ìì˜ ì—°ê²°ì´ ëŠê¸°ì§€ ì•ŠìŒ
> 2. **ë°ì´í„° ì¼ê´€ì„±**: ì‚¬ìš©ìëŠ” í•­ìƒ í•˜ë‚˜ì˜ ë°©ì—ë§Œ ì¡´ì¬
> 3. **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±**: ì„œë²„ ë©”ëª¨ë¦¬ ë° ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ 66% ì ˆê° (í‰ê·  3íƒ­ ì‚¬ìš© ê°€ì •)
> 4. **ë³´ì•ˆ ê°•í™”**: ì„¸ì…˜ í•˜ì´ì¬í‚¹ ì‹œë„ ì‹œ ì •ìƒ ì„¸ì…˜ì´ ë³´í˜¸ë˜ê³ , ê³µê²© ì‹œë„ê°€ ë¡œê·¸ì— ê¸°ë¡ë¨
>
> í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ `WebSocketService`ë¡œ ë°±ì—”ë“œ ì •ì±…ê³¼ ì¼ì¹˜ì‹œì¼œ, ìƒíƒœ ê´€ë¦¬ë¥¼ ë‹¨ìˆœí™”í•˜ê³  ì‚¬ìš©ìì—ê²Œ 'ì´ë¯¸ ì ‘ì† ì¤‘ì…ë‹ˆë‹¤'ë¼ëŠ” ëª…í™•í•œ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤."

---

### Q2: "ë‹¤ì¤‘ ì„¸ì…˜ì„ í—ˆìš©í•˜ë©´ì„œ ë™ê¸°í™”í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ ì•Šë‚˜ìš”?"

**ë‹µë³€ êµ¬ì¡°**: ëŒ€ì•ˆ ì¸ì • â†’ ë³µì¡ë„ ë¹„êµ â†’ íŠ¸ë ˆì´ë“œì˜¤í”„ ë¶„ì„

> "ë„¤, ê¸°ìˆ ì ìœ¼ë¡œëŠ” ê°€ëŠ¥í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Redis Pub/Subì´ë‚˜ Server-Sent Eventsë¡œ íƒ­ ê°„ ìƒíƒœë¥¼ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>
> í•˜ì§€ë§Œ **ë³µì¡ë„ ëŒ€ë¹„ ì‹¤ìµ**ê³¼ **ì‚¬ìš©ì ê²½í—˜**ì„ ê³ ë ¤í–ˆì„ ë•Œ, First-Come, First-Served ë°©ì‹ì˜ ë‹¨ì¼ ì„¸ì…˜ì´ ë” ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤:
>
> **ë‹¤ì¤‘ ì„¸ì…˜ + ë™ê¸°í™” ë°©ì‹ì˜ ë¬¸ì œì **:
> - íƒ­1ì—ì„œ ì¤€ë¹„ ì™„ë£Œ â†’ íƒ­2, íƒ­3ì— ìƒíƒœ ë™ê¸°í™” í•„ìš”
> - íƒ­2ì—ì„œ ë°© í‡´ì¥ â†’ ë‹¤ë¥¸ íƒ­ë“¤ë„ í‡´ì¥ ì²˜ë¦¬ í•„ìš”
> - ë„¤íŠ¸ì›Œí¬ ì§€ì—°ìœ¼ë¡œ íƒ­ ê°„ ìƒíƒœ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±
> - ë™ì‹œ ìš”ì²­ ì¶©ëŒ ì²˜ë¦¬ ë¡œì§ í•„ìš” (ì˜ˆ: ë‘ íƒ­ì—ì„œ ë™ì‹œì— ì •ë‹µ ì œì¶œ)
> - **ê°€ì¥ í° ë¬¸ì œ**: ê²Œì„ ì§„í–‰ ì¤‘ ì‹¤ìˆ˜ë¡œ ìƒˆ íƒ­ì„ ì—´ë©´ ê¸°ì¡´ ê²Œì„ì´ ëŠê¸¸ ìˆ˜ ìˆìŒ
>
> **First-Come, First-Served ë‹¨ì¼ ì„¸ì…˜ì˜ ì¥ì **:
> - **ê²Œì„ ê²½í—˜ ë³´í˜¸**: ë¨¼ì € ì—°ê²°ëœ ì„¸ì…˜ì´ ìš°ì„ ê¶Œì„ ê°€ì§€ë¯€ë¡œ, ê²Œì„ ì¤‘ ì‹¤ìˆ˜ë¡œ ìƒˆ íƒ­ì„ ì—´ì–´ë„ ì§„í–‰ ì¤‘ì¸ ê²Œì„ì´ ëŠê¸°ì§€ ì•ŠìŒ
> - ë™ê¸°í™” ë¡œì§ ë¶ˆí•„ìš” (Single Source of Truth)
> - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹¨ìˆœí™” (ë°© í‡´ì¥ = ì‚¬ìš©ì í‡´ì¥)
> - í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ ê´€ë¦¬ ê°„ì†Œí™”
>
> ë˜í•œ **ì‚¬ìš©ì í–‰ë™ ë¶„ì„** ê²°ê³¼, ì‹¤ì‹œê°„ ê²Œì„ ì¤‘ì—ëŠ” ëŒ€ë¶€ë¶„ í•˜ë‚˜ì˜ íƒ­ì—ë§Œ ì§‘ì¤‘í•˜ë¯€ë¡œ, ë‹¤ì¤‘ íƒ­ ì§€ì›ì˜ ì‹¤ì œ í•„ìš”ì„±ì´ ë‚®ìŠµë‹ˆë‹¤. ì˜¤íˆë ¤ ì‹¤ìˆ˜ë¡œ ì—¬ëŸ¬ íƒ­ì„ ì—´ì—ˆì„ ë•Œ ê¸°ì¡´ ê²Œì„ì„ ë³´í˜¸í•˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤."

---

### Q3: "í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ì…ì¥ì—ì„œ ë‹¨ì¼ ì„¸ì…˜ì˜ ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”?"

**ë‹µë³€ êµ¬ì¡°**: ê°œë°œ ê²½í—˜ â†’ ì‚¬ìš©ì ê²½í—˜ â†’ ìœ ì§€ë³´ìˆ˜ì„±

> "í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë¡œì„œ ì„¸ ê°€ì§€ ì¸¡ë©´ì—ì„œ í° ì´ì ì„ ëŠê¼ˆìŠµë‹ˆë‹¤:
>
> **1. ìƒíƒœ ê´€ë¦¬ ë‹¨ìˆœí™”**
> - React ìƒíƒœë¥¼ ë‹¨ì¼ ê°ì²´ë¡œ ê´€ë¦¬ ê°€ëŠ¥
> - íƒ­ë³„ ìƒíƒœ ì¶”ì  ë¶ˆí•„ìš”
> - Reduxë‚˜ Zustand ê°™ì€ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ë„ ì¶©ë¶„
>
> **2. ëª…í™•í•œ ì‚¬ìš©ì í”¼ë“œë°±**
> ```javascript
> if (errorMessage.includes('DUPLICATE_SESSION')) {
>     alert('ë‹¤ë¥¸ íƒ­ì—ì„œ ì´ë¯¸ ì ‘ì† ì¤‘ì…ë‹ˆë‹¤. ê¸°ì¡´ íƒ­ì„ ë‹«ì•„ì£¼ì„¸ìš”.');
> }
> ```
> - ì‚¬ìš©ìê°€ ì™œ ì—°ê²°ì´ ì•ˆ ë˜ëŠ”ì§€ ì¦‰ì‹œ ì´í•´
> - í•´ê²° ë°©ë²•ì„ ëª…í™•í•˜ê²Œ ì œì‹œ
>
> **3. ë””ë²„ê¹… ìš©ì´ì„±**
> - í•˜ë‚˜ì˜ WebSocket ì—°ê²°ë§Œ ì¶”ì í•˜ë©´ ë¨
> - ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ë„¤íŠ¸ì›Œí¬ íƒ­ í™•ì¸ ì‹œ ë©”ì‹œì§€ íë¦„ì´ ëª…í™•
> - ë²„ê·¸ ì¬í˜„ì´ ì‰¬ì›€ (íƒ­ ê°„ ìƒíƒœ ë¶ˆì¼ì¹˜ ê°™ì€ ë¹„ê²°ì •ì  ë²„ê·¸ ì—†ìŒ)
>
> ì‹¤ì œë¡œ ê°œë°œ ì¤‘ WebSocket ê´€ë ¨ ë²„ê·¸ê°€ ê±°ì˜ ë°œìƒí•˜ì§€ ì•Šì•˜ê³ , ë°œìƒí•´ë„ ë¹ ë¥´ê²Œ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤."

---

### Q4: "ë‹¨ì¼ ì„¸ì…˜ ì •ì±…ì˜ ë‹¨ì ì€ ì—†ë‚˜ìš”?"

**ë‹µë³€ êµ¬ì¡°**: ì†”ì§í•œ ì¸ì • â†’ ì™„í™” ë°©ë²• â†’ íŠ¸ë ˆì´ë“œì˜¤í”„ ì •ë‹¹í™”

> "ë¬¼ë¡  ë‹¨ì ë„ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ í° ë‹¨ì ì€ **ì‚¬ìš©ìê°€ ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì‹œì— ì‘ì—…í•  ìˆ˜ ì—†ë‹¤**ëŠ” ì ì…ë‹ˆë‹¤.
>
> **ì™„í™” ë°©ë²•**:
> 1. **ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€**: 'ë‹¤ë¥¸ íƒ­ì—ì„œ ì´ë¯¸ ì ‘ì† ì¤‘ì…ë‹ˆë‹¤' ì•ˆë‚´ë¡œ ìƒí™© ì„¤ëª…
> 2. **ìë™ ì¬ì—°ê²°**: ê¸°ì¡´ íƒ­ì„ ë‹«ìœ¼ë©´ ìƒˆ íƒ­ì—ì„œ ìë™ìœ¼ë¡œ ì—°ê²° ì‹œë„ ê°€ëŠ¥
> 3. **ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™œìš©**: ë§ˆì§€ë§‰ ì ‘ì† ì •ë³´ë¥¼ ì €ì¥í•´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ìë™ ë³µêµ¬
> 4. **First-Come ë³´í˜¸**: ê²Œì„ ì§„í–‰ ì¤‘ ì‹¤ìˆ˜ë¡œ ìƒˆ íƒ­ì„ ì—´ì–´ë„ ê¸°ì¡´ ê²Œì„ì´ ëŠê¸°ì§€ ì•ŠìŒ (ì˜¤íˆë ¤ ì¥ì )
>
> **íŠ¸ë ˆì´ë“œì˜¤í”„ ì •ë‹¹í™”**:
> - ì‹¤ì‹œê°„ í€´ì¦ˆ ê²Œì„ì´ë¼ëŠ” ë„ë©”ì¸ íŠ¹ì„±ìƒ, ì‚¬ìš©ìê°€ ë™ì‹œì— ì—¬ëŸ¬ ê²Œì„ì— ì°¸ì—¬í•  í•„ìš”ê°€ ì—†ìŒ
> - **First-Come, First-Served ë°©ì‹ì˜ í•µì‹¬ ê°€ì¹˜**: ê²Œì„ ì§„í–‰ ì¤‘ì¸ ì‚¬ìš©ìë¥¼ ë³´í˜¸í•˜ëŠ” ê²ƒì´ ë‹¤ì¤‘ íƒ­ ì§€ì›ë³´ë‹¤ ì¤‘ìš”
> - ì˜¤íˆë ¤ ë‹¤ì¤‘ íƒ­ í—ˆìš© ì‹œ:
    >   - ì‹¤ìˆ˜ë¡œ ì—¬ëŸ¬ ë°©ì— ì…ì¥í•˜ëŠ” í˜¼ë€ ë°œìƒ ê°€ëŠ¥
>   - ìƒˆ íƒ­ ì—°ê²°ë¡œ ê¸°ì¡´ ê²Œì„ì´ ëŠê¸¸ ìœ„í—˜
>   - íƒ­ ê°„ ìƒíƒœ ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ì‚¬ìš©ì í˜¼ë€
> - ë°ì´í„° ì¼ê´€ì„±ê³¼ ê²Œì„ ê²½í—˜ ë³´í˜¸ê°€ ë‹¤ì¤‘ íƒ­ ì§€ì›ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ìŒ
>
> **ì‹¤ì œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤**:
> - ê²Œì„ ì¤‘ ì‹¤ìˆ˜ë¡œ ë§í¬ë¥¼ ìƒˆ íƒ­ì—ì„œ ì—´ì–´ë„ â†’ ê¸°ì¡´ ê²Œì„ ê³„ì† ì§„í–‰ âœ“
> - ê³µê²©ìê°€ ê³„ì •ì„ íƒˆì·¨í•´ë„ â†’ ì •ìƒ ì‚¬ìš©ìì˜ ê²Œì„ì€ ë³´í˜¸ë¨ âœ“
>
> ë§Œì•½ í–¥í›„ 'ê´€ì „ ëª¨ë“œ'ì²˜ëŸ¼ ë‹¤ì¤‘ íƒ­ì´ í•„ìš”í•œ ê¸°ëŠ¥ì´ ì¶”ê°€ëœë‹¤ë©´, ì„¸ì…˜ íƒ€ì…ì„ êµ¬ë¶„(PLAYER/SPECTATOR)í•˜ì—¬ ì„ íƒì ìœ¼ë¡œ ë‹¤ì¤‘ ì„¸ì…˜ì„ í—ˆìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."

---

### Q5: "êµ¬í˜„ ê³¼ì •ì—ì„œ ê°€ì¥ ì–´ë ¤ì› ë˜ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?"

**ë‹µë³€ êµ¬ì¡°**: ê¸°ìˆ ì  ë„ì „ â†’ í•´ê²° ê³¼ì • â†’ í•™ìŠµ ë‚´ìš©

> "ê°€ì¥ ì–´ë ¤ì› ë˜ ì ì€ **ìŠ¤í…Œì¼ ì„¸ì…˜(Stale Session) ì²˜ë¦¬**ì˜€ìŠµë‹ˆë‹¤. First-Come, First-Served ì •ì±…ì—ì„œëŠ” ì´ ë¬¸ì œê°€ íŠ¹íˆ ì¤‘ìš”í•œë°, ì˜¤ë˜ëœ ì„¸ì…˜ì´ ë‚¨ì•„ìˆìœ¼ë©´ ì •ìƒì ì¸ ì¬ì ‘ì†ê¹Œì§€ ì°¨ë‹¨ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
>
> **ë¬¸ì œ ìƒí™©**:
> - ì‚¬ìš©ìê°€ íƒ­ì„ ë‹«ì§€ ì•Šê³  ë¸Œë¼ìš°ì €ë¥¼ ê°•ì œ ì¢…ë£Œ
> - ë„¤íŠ¸ì›Œí¬ ëŠê¹€ìœ¼ë¡œ DISCONNECT ë©”ì‹œì§€ê°€ ì„œë²„ì— ë„ë‹¬í•˜ì§€ ì•ŠìŒ
> - UserSessionRegistryì— ì˜¤ë˜ëœ ì„¸ì…˜ IDê°€ ë‚¨ì•„ìˆìŒ
> - ì‚¬ìš©ìê°€ ë‹¤ì‹œ ì ‘ì† ì‹œë„ â†’ ìŠ¤í…Œì¼ ì„¸ì…˜ ë•Œë¬¸ì— ì¤‘ë³µ ì„¸ì…˜ìœ¼ë¡œ ì°¨ë‹¨ë¨
> - **First-Come ì •ì±…ì˜ ì—­ì„¤**: ì´ë¯¸ ì£½ì€ ì„¸ì…˜ì´ ìƒˆë¡œìš´ ì •ìƒ ì„¸ì…˜ì„ ì°¨ë‹¨
>
> **í•´ê²° ê³¼ì •**:
> 1. **í•˜íŠ¸ë¹„íŠ¸ ì„¤ì •**: STOMP í•˜íŠ¸ë¹„íŠ¸ë¥¼ 30ì´ˆë¡œ ì„¤ì •í•´ ëŠê¸´ ì—°ê²° ìë™ ê°ì§€
> ```java
> heartbeatIncoming: 30000,
> heartbeatOutgoing: 30000
> ```
>
> 2. **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¶„ë¦¬**:
> - `SingleSessionChannelInterceptor`: ë°”ì¸ë”© ë° ê²€ì¦
> - `WebSocketEventsListener`: ì •ë¦¬ (finally ë¸”ë¡ì—ì„œ í•­ìƒ ì‹¤í–‰)
> ```java
> finally {
>     userSessionRegistry.unbind(userId, sessionId);
> }
> ```
>
> 3. **í™œì„± ì„¸ì…˜ ê²€ì¦**: DISCONNECT ì²˜ë¦¬ ì‹œ í™œì„± ì„¸ì…˜ì¸ì§€ ì¬í™•ì¸
> ```java
> if (!isActiveSession(userId, sessionId)) {
>     log.info("ë¹„í™œì„± ì„¸ì…˜ì˜ DISCONNECT ë¬´ì‹œ");
>     return false;
> }
> ```
>
> **í•™ìŠµ ë‚´ìš©**:
> - **First-Come ì •ì±…ì˜ ì–‘ë‚ ì˜ ê²€**: ì •ìƒ ì„¸ì…˜ì„ ë³´í˜¸í•˜ì§€ë§Œ, ìŠ¤í…Œì¼ ì„¸ì…˜ì´ ì •ìƒ ì¬ì ‘ì†ì„ ë§‰ì„ ìˆ˜ ìˆìŒ
> - WebSocketì˜ ë¹„ë™ê¸°ì  íŠ¹ì„±ê³¼ ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •ì„±ì„ ê³ ë ¤í•œ ì„¤ê³„ì˜ ì¤‘ìš”ì„±
> - ë‹¨ìˆœíˆ 'ì—°ê²°/í•´ì œ'ê°€ ì•„ë‹ˆë¼ 'í™œì„±/ë¹„í™œì„±' ìƒíƒœë¡œ ê´€ë¦¬í•´ì•¼ í•¨
> - í•˜íŠ¸ë¹„íŠ¸ë¥¼ í†µí•œ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§ì˜ ì¤‘ìš”ì„±
> - ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ 'ì •í™•íˆ í•œ ë²ˆ(Exactly Once)' ë³´ì¥ì˜ ì–´ë ¤ì›€
>
> ì´ ê²½í—˜ì„ í†µí•´ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œì˜ ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ëŠ¥ë ¥ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆì—ˆê³ , íŠ¹íˆ **ë³´í˜¸ ì •ì±…ì´ ì˜¤íˆë ¤ ë°©í•´ê°€ ë˜ëŠ” ìƒí™©**ì„ ì–´ë–»ê²Œ í•´ê²°í• ì§€ ë°°ìš¸ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤."

---

### Q6: "í™•ì¥ì„± ì¸¡ë©´ì—ì„œëŠ” ì–´ë–¤ê°€ìš”? ì‚¬ìš©ìê°€ ë§ì•„ì§€ë©´?"

**ë‹µë³€ êµ¬ì¡°**: í˜„ì¬ ì„¤ê³„ â†’ í™•ì¥ ì „ëµ â†’ ëª¨ë‹ˆí„°ë§ ê³„íš

> "í˜„ì¬ ì„¤ê³„ëŠ” **ìˆ˜í‰ í™•ì¥(Horizontal Scaling)**ì„ ê³ ë ¤í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
>
> **í˜„ì¬ ì•„í‚¤í…ì²˜**:
> - `UserSessionRegistry`ëŠ” ConcurrentHashMap ê¸°ë°˜ ì¸ë©”ëª¨ë¦¬ ì €ì¥ì†Œ
> - ë‹¨ì¼ ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë¬¸ì œì—†ì´ ë™ì‘
>
> **í™•ì¥ ì „ëµ (ë‹¤ì¤‘ ì„œë²„ í™˜ê²½)**:
> 1. **Redis ê¸°ë°˜ ì„¸ì…˜ ì €ì¥ì†Œ**:
> ```java
> @Component
> public class RedisSessionRegistry {
>     private final RedisTemplate<String, String> redisTemplate;
>     
>     public void bind(Long userId, String sessionId) {
>         redisTemplate.opsForValue().set(
>             "session:" + userId, 
>             sessionId, 
>             Duration.ofHours(24)
>         );
>     }
> }
> ```
>
> 2. **Sticky Session ì„¤ì •**:
> - ë¡œë“œ ë°¸ëŸ°ì„œì—ì„œ ì‚¬ìš©ìë³„ë¡œ ë™ì¼ ì„œë²„ë¡œ ë¼ìš°íŒ…
> - WebSocket ì—°ê²° ìœ ì§€ ì¤‘ì—ëŠ” ì„œë²„ ë³€ê²½ ë°©ì§€
>
> 3. **ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë„ì…**:
> - RabbitMQë‚˜ Kafkaë¡œ ì„œë²„ ê°„ ë©”ì‹œì§€ ë™ê¸°í™”
> - ì„œë²„ Aì—ì„œ ë°œìƒí•œ ì´ë²¤íŠ¸ë¥¼ ì„œë²„ Bì˜ í´ë¼ì´ì–¸íŠ¸ë„ ìˆ˜ì‹ 
>
> **ì„±ëŠ¥ ì˜ˆì¸¡**:
> - í˜„ì¬ êµ¬ì¡°: ë‹¨ì¼ ì„œë²„ì—ì„œ 10,000 ë™ì‹œ ì ‘ì† ì²˜ë¦¬ ê°€ëŠ¥ (AWS t3.medium ê¸°ì¤€)
> - Redis ë„ì… ì‹œ: 100,000+ ë™ì‹œ ì ‘ì† ì²˜ë¦¬ ê°€ëŠ¥ (ìˆ˜í‰ í™•ì¥)
>
> **ëª¨ë‹ˆí„°ë§ ê³„íš**:
> - CloudWatchë¡œ WebSocket ì—°ê²° ìˆ˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¶”ì 
> - ì„ê³„ê°’ ë„ë‹¬ ì‹œ ìë™ ìŠ¤ì¼€ì¼ ì•„ì›ƒ
> - ì„¸ì…˜ ìƒì„±/í•´ì œ ì§€ì—° ì‹œê°„ ëª¨ë‹ˆí„°ë§
>
> ë‹¨ì¼ ì„¸ì…˜ ì •ì±… ë•ë¶„ì— ì‚¬ìš©ìë‹¹ ì—°ê²° ìˆ˜ê°€ 1ê°œë¡œ ê³ ì •ë˜ì–´, í™•ì¥ ê³„íš ìˆ˜ë¦½ì´ í›¨ì”¬ ëª…í™•í•©ë‹ˆë‹¤."

---

## ì¶”ê°€ ì°¸ê³  ìë£Œ

### ê´€ë ¨ íŒŒì¼
- `backend/src/main/java/app/signbell/backend/config/SingleSessionChannelInterceptor.java`
- `backend/src/main/java/app/signbell/backend/config/UserSessionRegistry.java`
- `backend/src/main/java/app/signbell/backend/service/WebSocketSessionService.java`
- `frontend/src/services/websocket/websocketService.js`

### ê¸°ìˆ  ìŠ¤íƒ
- **ë°±ì—”ë“œ**: Spring Boot 3.x, STOMP, WebSocket
- **í”„ë¡ íŠ¸ì—”ë“œ**: React, @stomp/stompjs
- **ì¸ì¦**: JWT (ì¿ í‚¤ ê¸°ë°˜)

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ì •ìƒ ì—°ê²°**: ë‹¨ì¼ íƒ­ì—ì„œ ì—°ê²° â†’ ì„±ê³µ
2. **First-Come ë³´í˜¸**:
  - íƒ­1ì—ì„œ ê²Œì„ ì§„í–‰ ì¤‘
  - íƒ­2ì—ì„œ ì—°ê²° ì‹œë„ â†’ DUPLICATE_SESSION ì—ëŸ¬
  - íƒ­1ì˜ ê²Œì„ì€ ì¤‘ë‹¨ ì—†ì´ ê³„ì† ì§„í–‰ âœ“
3. **ìë™ í‡´ì¥**: ì—°ê²° í•´ì œ ì‹œ â†’ ë°©ì—ì„œ ìë™ í‡´ì¥ ë° ë‹¤ë¥¸ ì°¸ê°€ìì—ê²Œ ì•Œë¦¼
4. **ìŠ¤í…Œì¼ ì„¸ì…˜ ì²˜ë¦¬**:
  - ë„¤íŠ¸ì›Œí¬ ëŠê¹€ìœ¼ë¡œ DISCONNECT ë¯¸ì „ì†¡
  - í•˜íŠ¸ë¹„íŠ¸ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ìŠ¤í…Œì¼ ì„¸ì…˜ ê°ì§€
  - ìë™ ì •ë¦¬ í›„ ì¬ì—°ê²° í—ˆìš©
5. **ë³´ì•ˆ í…ŒìŠ¤íŠ¸**:
  - ì •ìƒ ì‚¬ìš©ì ê²Œì„ ì¤‘
  - ê³µê²©ìê°€ íƒˆì·¨í•œ í† í°ìœ¼ë¡œ ì—°ê²° ì‹œë„
  - ê³µê²©ì ì°¨ë‹¨ + ë³´ì•ˆ ë¡œê·¸ ê¸°ë¡
  - ì •ìƒ ì‚¬ìš©ìì˜ ê²Œì„ì€ ê³„ì† ì§„í–‰ âœ“

---

**ì‘ì„±ì¼**: 2025-10-25  
**ì‘ì„±ì**: ê°•ê´€ì£¼
**ë²„ì „**: 1.0
