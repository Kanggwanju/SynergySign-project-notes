# í€´ì¦ˆ ëŒ€ê¸°ë°© ë¦¬íŒ©í† ë§ ë° ê²Œì„ í˜ì´ì§€ í‡´ì¥ ë¡œì§ êµ¬í˜„ - í•´ê²° ë°©ì•ˆ

## ğŸ”¥ í•„ë…: ë°±ì—”ë“œ í‡´ì¥ ë¡œì§ì˜ í•µì‹¬

**ë°±ì—”ë“œì—ëŠ” ëª…ì‹œì ì¸ í‡´ì¥ API(`/leave`, `/exit` ë“±)ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**

ë°±ì—”ë“œëŠ” **ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ í‡´ì¥ ì²˜ë¦¬** ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
- í”„ë¡ íŠ¸ì—”ë“œê°€ `websocketService.disconnect()`ë¥¼ í˜¸ì¶œí•˜ë©´
- ë°±ì—”ë“œê°€ WebSocket DISCONNECT ì´ë²¤íŠ¸ë¥¼ ìë™ ê°ì§€
- `GameRoomLeaveService`ê°€ ìë™ìœ¼ë¡œ ëª¨ë“  í‡´ì¥ ì²˜ë¦¬ ìˆ˜í–‰
- ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì—ê²Œ ìë™ìœ¼ë¡œ ì•Œë¦¼ ì „ì†¡

**í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‹¨ìˆœíˆ disconnect()ë§Œ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤!**

---

## ëª©ì°¨
1. [ë¬¸ì œ ë¶„ì„](#1-ë¬¸ì œ-ë¶„ì„)
2. [ë°±ì—”ë“œ í‡´ì¥ ë¡œì§ ë¶„ì„](#2-ë°±ì—”ë“œ-í‡´ì¥-ë¡œì§-ë¶„ì„)
3. [í”„ë¡ íŠ¸ì—”ë“œ í‡´ì¥ ë¡œì§ ë¶„ì„](#3-í”„ë¡ íŠ¸ì—”ë“œ-í‡´ì¥-ë¡œì§-ë¶„ì„)
4. [í•´ê²° ë°©ì•ˆ](#4-í•´ê²°-ë°©ì•ˆ)
5. [êµ¬í˜„ ê°€ì´ë“œ](#5-êµ¬í˜„-ê°€ì´ë“œ)

---

## 1. ë¬¸ì œ ë¶„ì„

### 1.1 QuizWaitingRoomì˜ ë¬¸ì œì 

#### ì½”ë“œ ë³µì¡ë„
- **í˜„ì¬ ìƒíƒœ**: 600+ ì¤„ì˜ ë‹¨ì¼ íŒŒì¼ì— ëª¨ë“  ë¡œì§ ì§‘ì¤‘
- **ë¬¸ì œì **:
  - WebSocket, Janus, ì›¹ìº , ìƒíƒœ ê´€ë¦¬ê°€ ëª¨ë‘ í•œ ê³³ì— ìˆì–´ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
  - ë¡œì§ ì¬ì‚¬ìš© ë¶ˆê°€ëŠ¥
  - í…ŒìŠ¤íŠ¸ ì‘ì„± ì–´ë ¤ì›€
  - ì½”ë“œ ê°€ë…ì„± ì €í•˜

#### êµ¬ì¡°ì  ë¬¸ì œ
```javascript
// í˜„ì¬: ëª¨ë“  ê²ƒì´ í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ì—
QuizWaitingRoom.jsx (600+ lines)
â”œâ”€â”€ useState (10+ ê°œì˜ ìƒíƒœ)
â”œâ”€â”€ useEffect (8+ ê°œì˜ ì´í™íŠ¸)
â”œâ”€â”€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (15+ ê°œ)
â”œâ”€â”€ Janus ì—°ê²° ë¡œì§ (200+ lines)
â”œâ”€â”€ WebSocket ë¡œì§ (100+ lines)
â””â”€â”€ JSX ë Œë”ë§ (200+ lines)
```

### 1.2 QuizGamePageì˜ ë¬¸ì œì 

#### í‡´ì¥ ë¡œì§ ë¶€ì¬
- **í˜„ì¬ ìƒíƒœ**: `handleExit`ì™€ `confirmExit`ê°€ ìˆì§€ë§Œ ë‹¨ìˆœíˆ ë©”ì¸ìœ¼ë¡œ ì´ë™ë§Œ í•¨
- **ë¬¸ì œì **:
  - WebSocket ì—°ê²°ì´ ì •ë¦¬ë˜ì§€ ì•ŠìŒ
  - Janus WebRTC ì—°ê²°ì´ ë‚¨ì•„ìˆìŒ
  - FastAPI WebSocket ì—°ê²°ì´ ëŠì–´ì§€ì§€ ì•ŠìŒ
  - ë…¹í™”ê°€ ì¤‘ë‹¨ë˜ì§€ ì•ŠìŒ
  - ë°±ì—”ë“œì— í‡´ì¥ ì•Œë¦¼ì´ ì „ì†¡ë˜ì§€ ì•ŠìŒ

#### ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ìœ„í—˜
```javascript
// í˜„ì¬ confirmExit (ë¬¸ì œ ìˆìŒ)
const confirmExit = () => navigate('/main');

// ì •ë¦¬ë˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ë“¤:
// 1. janusRef.current - Janus ì„¸ì…˜
// 2. pluginHandleRef.current - VideoRoom í”ŒëŸ¬ê·¸ì¸
// 3. remoteFeedsRef.current - ì›ê²© í”¼ë“œë“¤
// 4. quizFastApi ì—°ê²° - FastAPI WebSocket
// 5. recordingRef.current - ë…¹í™” ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„
// 6. websocketService - Spring Boot WebSocket
```

---

## 2. ë°±ì—”ë“œ í‡´ì¥ ë¡œì§ ë¶„ì„

### 2.1 í‡´ì¥ ì²˜ë¦¬ íë¦„

#### ì „ì²´ ì•„í‚¤í…ì²˜
```
[í´ë¼ì´ì–¸íŠ¸]
    â†“ WebSocket DISCONNECT
[WebSocketEventsListener]
    â†“ onDisconnect()
[WebSocketSessionService]
    â†“ handleSessionDisconnect()
    â”œâ”€ í™œì„± ì„¸ì…˜ ê²€ì¦
    â”œâ”€ ë°© í‡´ì¥ ì²˜ë¦¬ ìœ„ì„
    â””â”€ ì„¸ì…˜ ì •ë¦¬
        â†“
[GameRoomLeaveService]
    â†“ leaveCurrentRoomByUser()
    â”œâ”€ ì°¸ê°€ì ì¡°íšŒ
    â””â”€ leaveRoom()
        â”œâ”€ ë°©ì¥? â†’ handleHostLeave()
        â””â”€ ì¼ë°˜? â†’ handleParticipantLeave()
```

### 2.2 í•µì‹¬ ì½”ë“œ ë¶„ì„

#### WebSocketEventsListener.java
```java
@EventListener
public void onDisconnect(SessionDisconnectEvent event) {
    DisconnectInfo disconnectInfo = extractDisconnectInfo(event);
    if (disconnectInfo == null) return;
    
    // ì‹¤ì œ ì²˜ë¦¬ëŠ” SessionManagerì—ê²Œ ìœ„ì„
    sessionManager.handleSessionDisconnect(
        disconnectInfo.userId(),
        disconnectInfo.sessionId()
    );
}
```
**ì—­í• **: WebSocket ì—°ê²° í•´ì œ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³  ì •ë³´ ì¶”ì¶œ



#### WebSocketSessionService.java
```java
public boolean handleSessionDisconnect(Long userId, String sessionId) {
    try {
        // 1. í™œì„± ì„¸ì…˜ ê²€ì¦ (ìŠ¤í…Œì¼ ì„¸ì…˜ ë¬´ì‹œ)
        if (!isActiveSession(userId, sessionId)) {
            log.info("ë¹„í™œì„± ì„¸ì…˜ì˜ DISCONNECT ë¬´ì‹œ");
            return false;
        }
        
        // 2. ë°© í‡´ì¥ ì²˜ë¦¬
        handleRoomLeave(userId);
        
        return true;
    } finally {
        // 3. ì„¸ì…˜ ì •ë¦¬ (í•­ìƒ ì‹¤í–‰)
        cleanupSession(userId, sessionId);
    }
}

private void handleRoomLeave(Long userId) {
    ParticipantEventResponse eventResp = leaveService.leaveCurrentRoomByUser(userId);
    Long roomId = eventResp.getGameRoomId();
    
    // ê°™ì€ ë°©ì˜ ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì—ê²Œ í‡´ì¥ ì•Œë¦¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸
    broadcastLeaveEvent(roomId, eventResp);
}
```
**ì—­í• **: ì„¸ì…˜ ê²€ì¦, ë°© í‡´ì¥ ì¡°ìœ¨, ì„¸ì…˜ ì •ë¦¬

#### GameRoomLeaveService.java - ì¼ë°˜ ì°¸ê°€ì í‡´ì¥
```java
private ParticipantEventResponse handleParticipantLeave(
    GameParticipant participant,
    GameRoom room,
    ParticipantResponse participantResponse,
    Long userId,
    Long gameRoomId
) {
    // 1. ì°¸ê°€ì ì •ë³´ ì‚­ì œ
    participantRepository.delete(participant);
    
    // 2. ë°©ì˜ í˜„ì¬ ì°¸ê°€ì ìˆ˜ ê°ì†Œ
    room.decrementParticipants();
    
    // 3. ê²Œì„ ì§„í–‰ ì¤‘ì´ë©´ ìºì‹œì—ì„œ í•´ë‹¹ ìœ ì € ì œê±°
    if (room.getStatus() == GameRoomStatus.IN_PROGRESS) {
        handleGameInProgressLeave(gameRoomId, userId);
    }
    
    // 4. ì—…ë°ì´íŠ¸ëœ ê²Œì„ë°© ì •ë³´ ì €ì¥
    gameRoomRepository.save(room);
    
    // 5. í‡´ì¥ ì´ë²¤íŠ¸ ì‘ë‹µ ìƒì„±
    return ParticipantEventResponse.builder()
        .eventType("PARTICIPANT_LEFT")
        .participant(participantResponse)
        .currentParticipants(room.getCurrentParticipants())
        .gameRoomId(room.getId())
        .roomClosed(false)
        .build();
}
```
**ì—­í• **: ì¼ë°˜ ì°¸ê°€ì í‡´ì¥ ì²˜ë¦¬ (DB ì‚­ì œ, ì¸ì› ê°ì†Œ, ìºì‹œ ì •ë¦¬)



#### GameRoomLeaveService.java - ë°©ì¥ í‡´ì¥ (ë°© ì¢…ë£Œ)
```java
private ParticipantEventResponse handleHostLeave(GameRoom room, ParticipantResponse hostResponse) {
    Long roomId = room.getId();
    
    // 1. ë°©ì¥ ì œì™¸í•œ ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì˜ userId ëª©ë¡ ì¡°íšŒ
    List<Long> otherParticipantUserIds = participantRepository
        .findByGameRoom_Id(roomId)
        .stream()
        .filter(p -> !p.isHost())
        .map(p -> p.getParticipant().getId())
        .toList();
    
    // 2. ë‚¨ì€ ëª¨ë“  ì°¸ê°€ìë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ì‚­ì œ (Bulk Delete)
    int deletedCount = participantRepository.deleteAllByGameRoom(room);
    
    // 3. ë°© ì¢…ë£Œ ì²˜ë¦¬
    room.closeRoom();
    
    // 4. ì—…ë°ì´íŠ¸ëœ ë°© ì •ë³´ ì €ì¥
    gameRoomRepository.save(room);
    
    // 5. ë‚¨ì€ ì°¸ê°€ìë“¤ì˜ ì„¸ì…˜ ì •ë¦¬
    if (!otherParticipantUserIds.isEmpty()) {
        sessionService.cleanupMultipleSessions(otherParticipantUserIds, roomId);
    }
    
    // 6. ë°© ì¢…ë£Œ ì´ë²¤íŠ¸ ì‘ë‹µ ìƒì„±
    return ParticipantEventResponse.builder()
        .eventType("ROOM_CLOSED")
        .participant(hostResponse)
        .currentParticipants(0)
        .gameRoomId(roomId)
        .roomClosed(true)
        .build();
}
```
**ì—­í• **: ë°©ì¥ í‡´ì¥ ì‹œ ë°© ì¢…ë£Œ ì²˜ë¦¬ (ëª¨ë“  ì°¸ê°€ì ì œê±°, ë°© ìƒíƒœ ë³€ê²½, ì„¸ì…˜ ì •ë¦¬)

#### GameRoomLeaveService.java - ê²Œì„ ì¤‘ í‡´ì¥ ì²˜ë¦¬
```java
private void handleGameInProgressLeave(Long roomId, Long userId) {
    QuizStateCache.GameRoomState roomState = quizStateCache.getOrCreateRoomState(roomId);
    
    // 1. ìºì‹œì—ì„œ ì ìˆ˜ ì œê±°
    roomState.removeUserScore(userId);
    
    // 2. ëª¨ë“  ë¬¸ì œ(1~8)ì—ì„œ í•´ë‹¹ ìœ ì €ì˜ ë„ì „ ìˆœì„œ ì œê±° ë° ì°¨ë¡€ í™•ì¸
    for (int questionNumber = 1; questionNumber <= 8; questionNumber++) {
        // í˜„ì¬ ë„ì „ ì°¨ë¡€ì¸ì§€ í™•ì¸
        Long currentChallenger = roomState.getCurrentChallenger(questionNumber);
        boolean wasCurrentChallenger = userId.equals(currentChallenger);
        
        // ë„ì „ ìˆœì„œì—ì„œ ì œê±°
        roomState.removeChallenger(questionNumber, userId);
        
        // ë„ì „ ì°¨ë¡€ì˜€ë‹¤ë©´ ë‹¤ìŒ ë„ì „ìì—ê²Œ ë„˜ê¹€
        if (wasCurrentChallenger) {
            Long nextChallenger = roomState.getNextChallenger(questionNumber);
            // ë‹¤ìŒ ë„ì „ì ì´ë²¤íŠ¸ ì „ì†¡ í•„ìš”
        }
    }
}
```
**ì—­í• **: ê²Œì„ ì§„í–‰ ì¤‘ í‡´ì¥ ì‹œ ìºì‹œ ì •ë¦¬ ë° ë‹¤ìŒ ë„ì „ì ì²˜ë¦¬



### 2.3 ë°±ì—”ë“œ í‡´ì¥ ì´ë²¤íŠ¸ íƒ€ì…

#### PARTICIPANT_LEFT (ì¼ë°˜ ì°¸ê°€ì í‡´ì¥)
```json
{
  "success": true,
  "message": "ì‚¬ìš©ìê°€ ì—°ê²°ì„ ëŠì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "eventType": "PARTICIPANT_LEFT",
    "participant": {
      "userId": 123,
      "nickname": "ì‚¬ìš©ì1",
      "profileImageUrl": "...",
      "host": false,
      "ready": false
    },
    "currentParticipants": 3,
    "gameRoomId": 456,
    "roomClosed": false
  }
}
```

#### ROOM_CLOSED (ë°©ì¥ í‡´ì¥ - ë°© ì¢…ë£Œ)
```json
{
  "success": true,
  "message": "ì‚¬ìš©ìê°€ ì—°ê²°ì„ ëŠì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "eventType": "ROOM_CLOSED",
    "participant": {
      "userId": 123,
      "nickname": "ë°©ì¥",
      "profileImageUrl": "...",
      "host": true,
      "ready": false
    },
    "currentParticipants": 0,
    "gameRoomId": 456,
    "roomClosed": true
  }
}
```

### 2.4 ë°±ì—”ë“œ í‡´ì¥ ë¡œì§ íŠ¹ì§•

#### í•µì‹¬ ì„¤ê³„ ì² í•™
**ğŸ”¥ ì¤‘ìš”: ë°±ì—”ë“œì—ëŠ” ëª…ì‹œì ì¸ í‡´ì¥ APIê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**

ë°±ì—”ë“œëŠ” **ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ í‡´ì¥ ì²˜ë¦¬** ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤:
- í´ë¼ì´ì–¸íŠ¸ê°€ `websocketService.disconnect()`ë¥¼ í˜¸ì¶œí•˜ë©´
- WebSocket ì—°ê²°ì´ ëŠì–´ì§€ê³ 
- ë°±ì—”ë“œì˜ `WebSocketEventsListener`ê°€ DISCONNECT ì´ë²¤íŠ¸ë¥¼ ìë™ ê°ì§€
- ìë™ìœ¼ë¡œ ë°© í‡´ì¥ ì²˜ë¦¬ ë° ì•Œë¦¼ ì „ì†¡

#### ì¥ì 
1. **ì™„ì „ ìë™í™”**: í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¨ìˆœíˆ ì—°ê²°ë§Œ ëŠìœ¼ë©´ ë¨ (API í˜¸ì¶œ ë¶ˆí•„ìš”)
2. **ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘**: ë¸Œë¼ìš°ì € ê°•ì œ ì¢…ë£Œ, ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ë“± ëª¨ë“  ê²½ìš° ìë™ ì²˜ë¦¬
3. **íŠ¸ëœì­ì…˜ ì•ˆì „ì„±**: @Transactionalë¡œ ë¡¤ë°± ë³´ì¥
4. **ìŠ¤í…Œì¼ ì„¸ì…˜ ë°©ì§€**: í™œì„± ì„¸ì…˜ë§Œ ì²˜ë¦¬í•˜ì—¬ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
5. **ë°© ì¢…ë£Œ ìë™í™”**: ë°©ì¥ í‡´ì¥ ì‹œ ìë™ìœ¼ë¡œ ë°© ì¢…ë£Œ ë° ì°¸ê°€ì ì •ë¦¬
6. **ê²Œì„ ìƒíƒœ ê´€ë¦¬**: ê²Œì„ ì¤‘ í‡´ì¥ ì‹œ ìºì‹œ ì •ë¦¬ ë° ë‹¤ìŒ ë„ì „ì ì²˜ë¦¬

#### í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­
1. **ëª…ì‹œì  í‡´ì¥ API í˜¸ì¶œ ê¸ˆì§€**: `/leave`, `/exit` ê°™ì€ ì—”ë“œí¬ì¸íŠ¸ ì—†ìŒ
2. **ë‹¨ìˆœíˆ disconnectë§Œ í˜¸ì¶œ**: `websocketService.disconnect()` ë§Œìœ¼ë¡œ ì¶©ë¶„
3. **ë°±ì—”ë“œê°€ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬**: ë°© í‡´ì¥, ì•Œë¦¼ ì „ì†¡, ì„¸ì…˜ ì •ë¦¬ ëª¨ë‘ ìë™
4. **ê²Œì„ ì¤‘ í‡´ì¥ ì‹œ ë‹¤ìŒ ë„ì „ì ì´ë²¤íŠ¸**: í˜„ì¬ êµ¬í˜„ì—ì„œ ëˆ„ë½ ê°€ëŠ¥ì„±
5. **ë°© ì¢…ë£Œ ì•Œë¦¼**: `/user/queue/room-closed`ë¡œ ê°œë³„ ì „ì†¡

---

## 3. í”„ë¡ íŠ¸ì—”ë“œ í‡´ì¥ ë¡œì§ ë¶„ì„

### 3.1 QuizWaitingRoomì˜ í‡´ì¥ ë¡œì§ (í˜„ì¬ êµ¬í˜„)

#### cleanupAndExit í•¨ìˆ˜
```javascript
const cleanupAndExit = async () => {
    try {
        console.log('ğŸšª ë°© ë‚˜ê°€ê¸° ì²˜ë¦¬ ì‹œì‘ (Merged)');
        
        // 1. Janus WebRTC ì •ë¦¬ (Context ì‚¬ìš©)
        if (janusRef.current) {
            try {
                janusRef.current.destroy();
                janusRef.current = null;
                pluginHandleRef.current = null;
                remoteFeedsRef.current = {};
                userIdToFeedIdRef.current = {};
                setIsJanusConnected(false);
                setRemoteStreams({});
                console.log('âœ… Janus ì •ë¦¬ ì™„ë£Œ');
            } catch (error) {
                console.error('Janus ì •ë¦¬ ì‹¤íŒ¨:', error);
            }
        }
        
        // 2. ì›¹ìº  ì •ë¦¬ (useWebcamStore ì‚¬ìš©)
        if (isWebcamOn) {
            stopWebcam();
            console.log('âœ… ì›¹ìº  ì •ë¦¬ ì™„ë£Œ (via store)');
        }
        
        // 3. WebSocket ì—°ê²° í•´ì œ
        websocketService.disconnect();
        console.log('âœ… WebSocket ì—°ê²° í•´ì œ ì™„ë£Œ (ì„œë²„ê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬)');
        
        // 4. ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
        navigate('/main');
    } catch (error) {
        console.error('âŒ ë°© ë‚˜ê°€ê¸° ì‹¤íŒ¨:', error);
        navigate('/main'); // ì‹¤íŒ¨ ì‹œì—ë„ ê°•ì œ ì´ë™
    }
};
```



#### í‡´ì¥ ë¡œì§ ë¶„ì„
**ì •ë¦¬ ìˆœì„œ**:
1. Janus WebRTC ì—°ê²° ì¢…ë£Œ
2. ì›¹ìº  ìŠ¤íŠ¸ë¦¼ ì •ì§€
3. WebSocket ì—°ê²° í•´ì œ (ë°±ì—”ë“œê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬)
4. ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™

**ì¥ì **:
- ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì •ë¦¬
- try-catchë¡œ ì—ëŸ¬ ì²˜ë¦¬
- finally ì—†ì´ë„ ì‹¤íŒ¨ ì‹œ ê°•ì œ ì´ë™

**ê°œì„  í•„ìš”**:
- 600ì¤„ ì»´í¬ë„ŒíŠ¸ì— í¬í•¨ë˜ì–´ ì¬ì‚¬ìš© ë¶ˆê°€
- ê²Œì„ í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ

### 3.2 QuizGamePageì˜ í‡´ì¥ ë¡œì§ (í˜„ì¬ êµ¬í˜„)

#### í˜„ì¬ ì½”ë“œ
```javascript
const handleExit = () => setShowExitModal(true);
const confirmExit = () => navigate('/main');
```

#### ë¬¸ì œì 
1. **ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì—†ìŒ**: ë‹¨ìˆœíˆ í˜ì´ì§€ë§Œ ì´ë™
2. **WebSocket ì—°ê²° ìœ ì§€**: ë°±ì—”ë“œì— í‡´ì¥ ì•Œë¦¼ ì—†ìŒ
3. **Janus ì—°ê²° ìœ ì§€**: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ
4. **FastAPI ì—°ê²° ìœ ì§€**: AI ì„œë²„ ì—°ê²° ìœ ì§€
5. **ë…¹í™” ê³„ì† ì§„í–‰**: ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ ê³„ì† ì‹¤í–‰

#### í•„ìš”í•œ ì •ë¦¬ ì‘ì—…
```javascript
// ê²Œì„ í˜ì´ì§€ì—ì„œ ì¶”ê°€ë¡œ ì •ë¦¬í•´ì•¼ í•  ê²ƒë“¤:
1. isRecordingRef.current = false
2. cancelAnimationFrame(recordingRef.current)
3. quizFastApi.disconnect()
4. fastApiConnectedRef.current = false
5. metaSentRef.current = false
6. + QuizWaitingRoomì˜ cleanupAndExit ë¡œì§
```

### 3.3 ê²Œì„ì—ì„œ ëŒ€ê¸°ì‹¤ ë³µê·€ ë¡œì§ (í˜„ì¬ êµ¬í˜„)

#### handleReturnToRoom í•¨ìˆ˜
```javascript
const handleReturnToRoom = async () => {
    console.log('ğŸšª ëŒ€ê¸°ì‹¤ë¡œ ëŒì•„ê°€ê¸° ìš”ì²­');
    
    // 1. WebRTC ì—°ê²° ì™„ì „ ì •ë¦¬
    // Remote feeds ì •ë¦¬
    if (remoteFeedsRef.current && Object.keys(remoteFeedsRef.current).length > 0) {
        Object.values(remoteFeedsRef.current).forEach(feed => {
            if (feed && typeof feed.detach === 'function') {
                feed.detach();
            }
        });
        remoteFeedsRef.current = {};
    }
    
    // Publisher ì •ë¦¬ - Janus ë°© ë– ë‚˜ê¸°
    if (pluginHandleRef.current) {
        await new Promise((resolve) => {
            const leave = { request: 'leave' };
            pluginHandleRef.current.send({ 
                message: leave,
                success: () => resolve(),
                error: () => resolve()
            });
            setTimeout(resolve, 500);
        });
        pluginHandleRef.current.detach();
        pluginHandleRef.current = null;
    }
    
    // Janus ì—°ê²° ì¢…ë£Œ
    if (janusRef.current) {
        janusRef.current.destroy();
        janusRef.current = null;
    }
    
    // ìƒíƒœ ì´ˆê¸°í™”
    setRemoteStreams({});
    setIsJanusConnected(false);
    userIdToFeedIdRef.current = {};
    
    // 2. ëŒ€ê¸°ì‹¤ë¡œ ì´ë™
    navigate(`/quiz/waiting/${roomId}`, {
        state: {
            returnFromGame: true,
            needsRejoin: true
        }
    });
};
```



#### íŠ¹ì§•
- **Janus ë°© ëª…ì‹œì  ë– ë‚˜ê¸°**: `leave` ìš”ì²­ ì „ì†¡
- **Promise ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬**: íƒ€ì„ì•„ì›ƒ í¬í•¨
- **WebSocket ìœ ì§€**: ëŒ€ê¸°ì‹¤ì—ì„œ ì¬ì‚¬ìš©
- **ì›¹ìº  ìœ ì§€**: ëŒ€ê¸°ì‹¤ì—ì„œ ê³„ì† ì‚¬ìš©

---

## 4. í•´ê²° ë°©ì•ˆ

### 4.1 ì „ì²´ ì•„í‚¤í…ì²˜ ì„¤ê³„

#### ëª©í‘œ êµ¬ì¡°
```
[ê³µí†µ í›…]
useRoomExit.js
â”œâ”€ Janus ì •ë¦¬
â”œâ”€ ì›¹ìº  ì •ë¦¬
â”œâ”€ WebSocket í•´ì œ
â””â”€ í˜ì´ì§€ ì´ë™

[ëŒ€ê¸°ë°©]
QuizWaitingRoom.jsx (150-200 lines)
â”œâ”€ useWaitingRoom() - ìƒíƒœ ê´€ë¦¬
â”œâ”€ useWaitingWebSocket() - WebSocket ì´ë²¤íŠ¸
â”œâ”€ useWaitingJanus() - WebRTC ì—°ê²°
â”œâ”€ useRoomExit() - í‡´ì¥ ë¡œì§
â””â”€ ì»´í¬ë„ŒíŠ¸ ì¡°í•©
    â”œâ”€ WaitingRoomHeader
    â”œâ”€ WaitingRoomControls
    â””â”€ WaitingParticipantGrid

[ê²Œì„ í˜ì´ì§€]
QuizGamePage.jsx
â”œâ”€ useQuizGame() - ê²Œì„ ìƒíƒœ (ê¸°ì¡´)
â”œâ”€ useQuizWebSocket() - WebSocket (ê¸°ì¡´)
â”œâ”€ useRoomExit() - í‡´ì¥ ë¡œì§ (ì‹ ê·œ)
â””â”€ ê²Œì„ ì „ìš© ì •ë¦¬ ë¡œì§
    â”œâ”€ ë…¹í™” ì¤‘ë‹¨
    â””â”€ FastAPI ì—°ê²° í•´ì œ
```

### 4.2 ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš

#### Phase 1: ê³µí†µ í‡´ì¥ í›… ìƒì„±
**ëª©í‘œ**: ë‘ í˜ì´ì§€ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  í‡´ì¥ ë¡œì§ ì¶”ìƒí™”

**íŒŒì¼**: `frontend/src/hooks/useRoomExit.js`

**ê¸°ëŠ¥**:
- Janus WebRTC ì—°ê²° ì •ë¦¬
- ì›¹ìº  ìŠ¤íŠ¸ë¦¼ ì •ì§€
- WebSocket ì—°ê²° í•´ì œ
- í˜ì´ì§€ ì´ë™

**ì¸í„°í˜ì´ìŠ¤**:
```javascript
const { cleanupAndExit } = useRoomExit({
  janusRef,
  pluginHandleRef,
  remoteFeedsRef,
  userIdToFeedIdRef,
  setRemoteStreams,
  setIsJanusConnected,
  stopWebcam,
  isWebcamOn,
  navigateTo: '/main' // ì´ë™í•  ê²½ë¡œ
});
```

#### Phase 2: ëŒ€ê¸°ë°© ë¦¬íŒ©í† ë§
**ëª©í‘œ**: QuizWaitingRoomì„ QuizGamePageì™€ ë™ì¼í•œ êµ¬ì¡°ë¡œ ë¦¬íŒ©í† ë§

**2-1. ì»¤ìŠ¤í…€ í›… ìƒì„±**
- `useWaitingRoom.js`: ë°© ì •ë³´, ì°¸ê°€ì ìƒíƒœ ê´€ë¦¬
- `useWaitingWebSocket.js`: WebSocket ì´ë²¤íŠ¸ ì²˜ë¦¬
- `useWaitingJanus.js`: Janus WebRTC ì—°ê²° ê´€ë¦¬

**2-2. ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬**
- `WaitingRoomHeader.jsx`: ë°© ì •ë³´ í—¤ë”
- `WaitingRoomControls.jsx`: ì›¹ìº /ì¤€ë¹„ ë²„íŠ¼
- `WaitingParticipantCard.jsx`: ì°¸ê°€ì ì¹´ë“œ
- `WaitingParticipantGrid.jsx`: ì°¸ê°€ì ê·¸ë¦¬ë“œ

**2-3. ë©”ì¸ ì»´í¬ë„ŒíŠ¸ ë¦¬íŒ©í† ë§**
- ê¸°ì¡´ ë¡œì§ì„ í›…ìœ¼ë¡œ ì´ë™
- JSXë¥¼ ì»´í¬ë„ŒíŠ¸ë¡œ êµì²´
- useRoomExit í›… í†µí•©



#### Phase 3: ê²Œì„ í˜ì´ì§€ í‡´ì¥ ë¡œì§ êµ¬í˜„
**ëª©í‘œ**: QuizGamePageì— ì™„ì „í•œ í‡´ì¥ ë¡œì§ ì¶”ê°€

**3-1. useRoomExit í›… í†µí•©**
```javascript
const { cleanupAndExit } = useRoomExit({
  janusRef,
  pluginHandleRef,
  remoteFeedsRef,
  userIdToFeedIdRef,
  setRemoteStreams,
  setIsJanusConnected,
  stopWebcam,
  isWebcamOn,
  navigateTo: '/main'
});
```

**3-2. ê²Œì„ ì „ìš© ì •ë¦¬ ë¡œì§ ì¶”ê°€**
```javascript
const handleGameExit = async () => {
  try {
    // 1. ë…¹í™” ì¤‘ë‹¨
    if (isRecordingRef.current) {
      isRecordingRef.current = false;
      if (recordingRef.current) {
        cancelAnimationFrame(recordingRef.current);
        recordingRef.current = null;
      }
    }
    
    // 2. FastAPI WebSocket ì—°ê²° í•´ì œ
    quizFastApi.disconnect();
    fastApiConnectedRef.current = false;
    metaSentRef.current = false;
    
    // 3. ê³µí†µ í‡´ì¥ ë¡œì§ ì‹¤í–‰
    await cleanupAndExit();
    
  } catch (error) {
    console.error('âŒ ê²Œì„ í‡´ì¥ ì‹¤íŒ¨:', error);
    navigate('/main');
  }
};
```

**3-3. ëª¨ë‹¬ ì—°ê²°**
```javascript
const handleExit = () => setShowExitModal(true);
const confirmExit = () => handleGameExit();
```

#### Phase 4: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
**ëª©í‘œ**: ëª¨ë“  í‡´ì¥ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:
1. ëŒ€ê¸°ë°© ì¼ë°˜ ì°¸ê°€ì í‡´ì¥
2. ëŒ€ê¸°ë°© ë°©ì¥ í‡´ì¥ (ë°© ì¢…ë£Œ)
3. ê²Œì„ ë„ì „ ëŒ€ê¸° ì¤‘ í‡´ì¥
4. ê²Œì„ ë‚´ ì°¨ë¡€ ì¤‘ í‡´ì¥
5. ê²Œì„ ë‹¤ë¥¸ ì‚¬ëŒ ì°¨ë¡€ ì¤‘ í‡´ì¥
6. ê²Œì„ ì¢…ë£Œ í›„ ëŒ€ê¸°ì‹¤ ë³µê·€
7. ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ì‹œë‚˜ë¦¬ì˜¤

### 4.3 í•µì‹¬ êµ¬í˜„ ì½”ë“œ

#### useRoomExit.js (ê³µí†µ í‡´ì¥ í›…)
```javascript
/**
 * í€´ì¦ˆ ë°© í‡´ì¥ì„ ìœ„í•œ ê³µí†µ í›…
 * 
 * ğŸ”¥ ì¤‘ìš”: ë°±ì—”ë“œì—ëŠ” ëª…ì‹œì ì¸ í‡´ì¥ APIê°€ ì—†ìŠµë‹ˆë‹¤!
 * ì´ í›…ì€ ë‹¨ìˆœíˆ websocketService.disconnect()ë¥¼ í˜¸ì¶œí•˜ê³ ,
 * ë°±ì—”ë“œê°€ DISCONNECT ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬í•©ë‹ˆë‹¤.
 * 
 * ì²˜ë¦¬ ìˆœì„œ:
 * 1. ê²Œì„ ì „ìš© ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (onBeforeExit)
 * 2. Janus WebRTC ì •ë¦¬
 * 3. ì›¹ìº  ì •ë¦¬
 * 4. WebSocket ì—°ê²° í•´ì œ â­ (ë°±ì—”ë“œê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬)
 * 5. í˜ì´ì§€ ì´ë™
 */
import { useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import websocketService from '../services/websocket/websocketService';

export const useRoomExit = ({
  janusRef,
  pluginHandleRef,
  remoteFeedsRef,
  userIdToFeedIdRef,
  setRemoteStreams,
  setIsJanusConnected,
  stopWebcam,
  isWebcamOn,
  navigateTo = '/main',
  onBeforeExit = null, // í‡´ì¥ ì „ ì¶”ê°€ ì‘ì—… (ê²Œì„ í˜ì´ì§€: ë…¹í™” ì¤‘ë‹¨, FastAPI í•´ì œ)
}) => {
  const navigate = useNavigate();
  
  const cleanupAndExit = useCallback(async () => {
    try {
      console.log('ğŸšª ë°© ë‚˜ê°€ê¸° ì²˜ë¦¬ ì‹œì‘');
      
      // 0. í‡´ì¥ ì „ ì¶”ê°€ ì‘ì—… ì‹¤í–‰ (ì˜µì…˜)
      // ê²Œì„ í˜ì´ì§€: ë…¹í™” ì¤‘ë‹¨, FastAPI WebSocket í•´ì œ
      if (onBeforeExit) {
        await onBeforeExit();
      }
      
      // 1. Janus WebRTC ì •ë¦¬
      if (janusRef.current) {
        try {
          // Remote feeds ì •ë¦¬
          if (remoteFeedsRef.current) {
            Object.values(remoteFeedsRef.current).forEach(feed => {
              try {
                if (feed && typeof feed.detach === 'function') {
                  feed.detach();
                }
              } catch (error) {
                console.error('Remote feed detach ì‹¤íŒ¨:', error);
              }
            });
            remoteFeedsRef.current = {};
          }
          
          // Publisher ì •ë¦¬
          if (pluginHandleRef.current) {
            try {
              pluginHandleRef.current.detach();
            } catch (error) {
              console.error('Plugin detach ì‹¤íŒ¨:', error);
            }
            pluginHandleRef.current = null;
          }
          
          // Janus ì„¸ì…˜ ì¢…ë£Œ
          janusRef.current.destroy();
          janusRef.current = null;
          
          // ìƒíƒœ ì´ˆê¸°í™”
          if (userIdToFeedIdRef.current) {
            userIdToFeedIdRef.current = {};
          }
          setIsJanusConnected(false);
          setRemoteStreams({});
          
          console.log('âœ… Janus ì •ë¦¬ ì™„ë£Œ');
        } catch (error) {
          console.error('âŒ Janus ì •ë¦¬ ì‹¤íŒ¨:', error);
        }
      }
      
      // 2. ì›¹ìº  ì •ë¦¬
      if (isWebcamOn && stopWebcam) {
        try {
          stopWebcam();
          console.log('âœ… ì›¹ìº  ì •ë¦¬ ì™„ë£Œ');
        } catch (error) {
          console.error('âŒ ì›¹ìº  ì •ë¦¬ ì‹¤íŒ¨:', error);
        }
      }
      
      // 3. WebSocket ì—°ê²° í•´ì œ
      // â­â­â­ í•µì‹¬: disconnect()ë§Œ í˜¸ì¶œí•˜ë©´ ë!
      // ë°±ì—”ë“œê°€ DISCONNECT ì´ë²¤íŠ¸ë¥¼ ìë™ ê°ì§€í•˜ì—¬:
      // - GameRoomLeaveService.leaveCurrentRoomByUser() ìë™ ì‹¤í–‰
      // - ì°¸ê°€ì ì •ë³´ DB ì‚­ì œ
      // - ë°© ì°¸ê°€ì ìˆ˜ ê°ì†Œ
      // - ê²Œì„ ì¤‘ì´ë©´ ìºì‹œ ì •ë¦¬
      // - ë°©ì¥ì´ë©´ ë°© ì¢…ë£Œ ë° ë‚¨ì€ ì°¸ê°€ì ì„¸ì…˜ ì •ë¦¬
      // - PARTICIPANT_LEFT ë˜ëŠ” ROOM_CLOSED ì´ë²¤íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸
      // ëª¨ë“  ê²ƒì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤!
      try {
        websocketService.disconnect();
        console.log('âœ… WebSocket ì—°ê²° í•´ì œ ì™„ë£Œ (ë°±ì—”ë“œê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬)');
      } catch (error) {
        console.error('âŒ WebSocket í•´ì œ ì‹¤íŒ¨:', error);
      }
      
      // 4. í˜ì´ì§€ ì´ë™
      navigate(navigateTo);
      
    } catch (error) {
      console.error('âŒ ë°© ë‚˜ê°€ê¸° ì‹¤íŒ¨:', error);
      // ì‹¤íŒ¨ ì‹œì—ë„ ê°•ì œ ì´ë™
      navigate(navigateTo);
    }
  }, [
    janusRef,
    pluginHandleRef,
    remoteFeedsRef,
    userIdToFeedIdRef,
    setRemoteStreams,
    setIsJanusConnected,
    stopWebcam,
    isWebcamOn,
    navigate,
    navigateTo,
    onBeforeExit,
  ]);
  
  return { cleanupAndExit };
};
```



#### QuizGamePageì—ì„œ ì‚¬ìš©
```javascript
// QuizGamePage.jsx
import { useRoomExit } from '../../hooks/useRoomExit';

const QuizGamePage = () => {
  // ... ê¸°ì¡´ ì½”ë“œ ...
  
  // í‡´ì¥ í›… ì‚¬ìš©
  const { cleanupAndExit } = useRoomExit({
    janusRef,
    pluginHandleRef,
    remoteFeedsRef,
    userIdToFeedIdRef,
    setRemoteStreams,
    setIsJanusConnected,
    stopWebcam,
    isWebcamOn,
    navigateTo: '/main',
    onBeforeExit: async () => {
      // ê²Œì„ ì „ìš© ì •ë¦¬ ì‘ì—…
      console.log('ğŸ® ê²Œì„ ì „ìš© ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì‹œì‘');
      
      // 1. ë…¹í™” ì¤‘ë‹¨
      if (isRecordingRef.current) {
        isRecordingRef.current = false;
        if (recordingRef.current) {
          cancelAnimationFrame(recordingRef.current);
          recordingRef.current = null;
        }
        console.log('âœ… ë…¹í™” ì¤‘ë‹¨ ì™„ë£Œ');
      }
      
      // 2. FastAPI WebSocket ì—°ê²° í•´ì œ
      try {
        quizFastApi.disconnect();
        fastApiConnectedRef.current = false;
        metaSentRef.current = false;
        console.log('âœ… FastAPI ì—°ê²° í•´ì œ ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ FastAPI ì—°ê²° í•´ì œ ì‹¤íŒ¨:', error);
      }
    }
  });
  
  // ë‚˜ê°€ê¸° ë²„íŠ¼ í•¸ë“¤ëŸ¬
  const handleExit = () => setShowExitModal(true);
  const confirmExit = () => cleanupAndExit();
  
  // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
};
```

#### QuizWaitingRoomì—ì„œ ì‚¬ìš© (ë¦¬íŒ©í† ë§ í›„)
```javascript
// QuizWaitingRoom.jsx
import { useRoomExit } from '../../hooks/useRoomExit';
import { useWaitingRoom } from '../../hooks/useWaitingRoom';
import { useWaitingWebSocket } from '../../hooks/useWaitingWebSocket';
import { useWaitingJanus } from '../../hooks/useWaitingJanus';

const QuizWaitingRoom = () => {
  const { roomId } = useParams();
  const { user } = useAuthStore();
  const myUserId = user?.userId;
  
  // ìƒíƒœ ê´€ë¦¬ í›…
  const {
    roomInfo,
    setRoomInfo,
    participants,
    setParticipants,
    allReady,
  } = useWaitingRoom();
  
  // WebSocket í›…
  const { setReady, startGame } = useWaitingWebSocket({
    roomId,
    myUserId,
    onRoomJoin: handleRoomJoin,
    onParticipantEvent: handleParticipantEvent,
    onGameStart: handleGameStart,
    onRoomClosed: handleRoomClosed,
    onError: handleError,
  });
  
  // Janus WebRTC í›…
  useWaitingJanus({
    roomId,
    myUserId,
    participants,
    isWebcamOn,
    stream,
  });
  
  // í‡´ì¥ í›…
  const { cleanupAndExit } = useRoomExit({
    janusRef,
    pluginHandleRef,
    remoteFeedsRef,
    userIdToFeedIdRef,
    setRemoteStreams,
    setIsJanusConnected,
    stopWebcam,
    isWebcamOn,
    navigateTo: '/main',
  });
  
  // ë‚˜ê°€ê¸° ë²„íŠ¼ í•¸ë“¤ëŸ¬
  const handleExit = () => setShowExitModal(true);
  const confirmExit = () => cleanupAndExit();
  
  // ... JSX ë Œë”ë§ ...
};
```

---

## 5. êµ¬í˜„ ê°€ì´ë“œ

### 5.1 ìš°ì„ ìˆœìœ„

#### ë†’ìŒ (ì¦‰ì‹œ êµ¬í˜„)
1. **useRoomExit í›… ìƒì„±**: ê³µí†µ í‡´ì¥ ë¡œì§ ì¶”ìƒí™”
2. **QuizGamePage í‡´ì¥ ë¡œì§**: ê²Œì„ ì¤‘ ë‚˜ê°€ê¸° ê¸°ëŠ¥ êµ¬í˜„

#### ì¤‘ê°„ (ë‹¤ìŒ ìŠ¤í”„ë¦°íŠ¸)
3. **useWaitingWebSocket í›…**: WebSocket ë¡œì§ ë¶„ë¦¬
4. **useWaitingJanus í›…**: Janus ë¡œì§ ë¶„ë¦¬
5. **useWaitingRoom í›…**: ìƒíƒœ ê´€ë¦¬ ë¶„ë¦¬

#### ë‚®ìŒ (ì ì§„ì  ê°œì„ )
6. **ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬**: UI ëª¨ë“ˆí™”
7. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸

### 5.2 êµ¬í˜„ ìˆœì„œ

#### Step 1: useRoomExit í›… ìƒì„± (1-2ì‹œê°„)
```bash
# íŒŒì¼ ìƒì„±
frontend/src/hooks/useRoomExit.js

# êµ¬í˜„ ë‚´ìš©
- Janus ì •ë¦¬ ë¡œì§
- ì›¹ìº  ì •ë¦¬ ë¡œì§
- WebSocket í•´ì œ ë¡œì§
- onBeforeExit ì½œë°± ì§€ì›
```

#### Step 2: QuizGamePage í‡´ì¥ ë¡œì§ êµ¬í˜„ (2-3ì‹œê°„)
```bash
# ìˆ˜ì • íŒŒì¼
frontend/src/pages/quiz/QuizGamePage.jsx

# êµ¬í˜„ ë‚´ìš©
- useRoomExit í›… import
- onBeforeExitì— ê²Œì„ ì „ìš© ì •ë¦¬ ë¡œì§ ì¶”ê°€
- confirmExit í•¨ìˆ˜ ìˆ˜ì •
- í…ŒìŠ¤íŠ¸
```

#### Step 3: QuizWaitingRoomì— useRoomExit ì ìš© (1ì‹œê°„)
```bash
# ìˆ˜ì • íŒŒì¼
frontend/src/pages/quiz/QuizWaitingRoom.jsx

# êµ¬í˜„ ë‚´ìš©
- useRoomExit í›… import
- cleanupAndExit í•¨ìˆ˜ êµì²´
- ê¸°ì¡´ ë¡œì§ ì œê±°
- í…ŒìŠ¤íŠ¸
```



#### Step 4: ëŒ€ê¸°ë°© ë¦¬íŒ©í† ë§ (8-10ì‹œê°„)
```bash
# ìƒˆë¡œ ìƒì„±í•  íŒŒì¼ë“¤
frontend/src/hooks/useWaitingRoom.js
frontend/src/hooks/useWaitingWebSocket.js
frontend/src/hooks/useWaitingJanus.js
frontend/src/components/quiz/waiting/WaitingRoomHeader.jsx
frontend/src/components/quiz/waiting/WaitingRoomControls.jsx
frontend/src/components/quiz/waiting/WaitingParticipantCard.jsx
frontend/src/components/quiz/waiting/WaitingParticipantGrid.jsx

# ìˆ˜ì • íŒŒì¼
frontend/src/pages/quiz/QuizWaitingRoom.jsx (ëŒ€í­ ì¶•ì†Œ)
```

### 5.3 í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ëŒ€ê¸°ë°© í‡´ì¥ í…ŒìŠ¤íŠ¸
- [ ] ì¼ë°˜ ì°¸ê°€ìê°€ ë‚˜ê°€ê¸° ë²„íŠ¼ í´ë¦­
  - [ ] í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
  - [ ] í™•ì¸ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
  - [ ] ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì—ê²Œ í‡´ì¥ ì•Œë¦¼ í‘œì‹œ
  - [ ] ì°¸ê°€ì ìˆ˜ ê°ì†Œ
  - [ ] ì›¹ìº  ìŠ¤íŠ¸ë¦¼ ì •ì§€
  - [ ] Janus ì—°ê²° ì¢…ë£Œ
  - [ ] WebSocket ì—°ê²° í•´ì œ

- [ ] ë°©ì¥ì´ ë‚˜ê°€ê¸° ë²„íŠ¼ í´ë¦­
  - [ ] í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
  - [ ] í™•ì¸ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
  - [ ] ë‚¨ì€ ì°¸ê°€ìë“¤ì—ê²Œ ë°© ì¢…ë£Œ ì•Œë¦¼ í‘œì‹œ
  - [ ] ë‚¨ì€ ì°¸ê°€ìë“¤ ìë™ìœ¼ë¡œ ë©”ì¸ìœ¼ë¡œ ì´ë™
  - [ ] ë°© ìƒíƒœê°€ CLOSEDë¡œ ë³€ê²½

#### ê²Œì„ ì¤‘ í‡´ì¥ í…ŒìŠ¤íŠ¸
- [ ] ë„ì „ ëŒ€ê¸° ì¤‘ ë‚˜ê°€ê¸°
  - [ ] í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
  - [ ] í™•ì¸ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
  - [ ] ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì—ê²Œ í‡´ì¥ ì•Œë¦¼
  - [ ] ê²Œì„ ê³„ì† ì§„í–‰

- [ ] ë‚´ ì°¨ë¡€ ì¤‘ ë‚˜ê°€ê¸°
  - [ ] ë…¹í™” ì¤‘ë‹¨ í™•ì¸
  - [ ] FastAPI ì—°ê²° í•´ì œ í™•ì¸
  - [ ] ë‹¤ìŒ ë„ì „ìì—ê²Œ ì°¨ë¡€ ë„˜ì–´ê°
  - [ ] ê²Œì„ ê³„ì† ì§„í–‰

- [ ] ë‹¤ë¥¸ ì‚¬ëŒ ì°¨ë¡€ ì¤‘ ë‚˜ê°€ê¸°
  - [ ] ì •ìƒì ìœ¼ë¡œ í‡´ì¥
  - [ ] ê²Œì„ ê³„ì† ì§„í–‰

#### ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
- [ ] ë„¤íŠ¸ì›Œí¬ ëŠê¹€
  - [ ] ë°±ì—”ë“œê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬
  - [ ] ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì—ê²Œ ì•Œë¦¼

- [ ] ë¸Œë¼ìš°ì € ê°•ì œ ì¢…ë£Œ
  - [ ] WebSocket DISCONNECT ì´ë²¤íŠ¸ ë°œìƒ
  - [ ] ë°±ì—”ë“œê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬

- [ ] ë™ì‹œ ë‹¤ë°œì  í‡´ì¥
  - [ ] ê° ì°¸ê°€ì ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬
  - [ ] ë°©ì¥ì´ ë§ˆì§€ë§‰ì´ë©´ ë°© ì¢…ë£Œ

### 5.4 ì£¼ì˜ì‚¬í•­

#### 1. Janus ì—°ê²° ì •ë¦¬ ìˆœì„œ
```javascript
// ì˜¬ë°”ë¥¸ ìˆœì„œ
1. Remote feeds detach
2. Plugin handle detach
3. Janus session destroy
4. Refs ì´ˆê¸°í™”
5. State ì´ˆê¸°í™”

// ì˜ëª»ëœ ìˆœì„œ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ)
1. Janus session destroy
2. Remote feeds detach (ì´ë¯¸ ì„¸ì…˜ì´ ì—†ì–´ì„œ ì‹¤íŒ¨)
```

#### 2. WebSocket ì—°ê²° í•´ì œ íƒ€ì´ë°
```javascript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ë°±ì—”ë“œê°€ DISCONNECT ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ìë™ í‡´ì¥ ì²˜ë¦¬)
websocketService.disconnect();

// âŒ ì˜ëª»ëœ ë°©ë²• (ëª…ì‹œì  í‡´ì¥ APIê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ!)
websocketService.leaveRoom(roomId);  // ì´ëŸ° API ì—†ìŒ!
websocketService.sendMessage('/app/room/leave', {}); // ì´ëŸ° ì—”ë“œí¬ì¸íŠ¸ ì—†ìŒ!

// âŒ ë¶ˆí•„ìš”í•œ ë°©ë²• (disconnectë§Œìœ¼ë¡œ ì¶©ë¶„)
websocketService.sendMessage('/app/room/exit', {});
websocketService.disconnect();
```

**ì¤‘ìš”**: ë°±ì—”ë“œëŠ” WebSocket DISCONNECT ì´ë²¤íŠ¸ë§Œìœ¼ë¡œ ëª¨ë“  í‡´ì¥ ì²˜ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¨ìˆœíˆ `disconnect()`ë§Œ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.

#### 3. ê²Œì„ ì¤‘ í‡´ì¥ ì‹œ ì¶”ê°€ ì •ë¦¬
```javascript
// ë°˜ë“œì‹œ ì •ë¦¬í•´ì•¼ í•  ê²ƒë“¤
1. isRecordingRef.current = false
2. cancelAnimationFrame(recordingRef.current)
3. quizFastApi.disconnect()
4. fastApiConnectedRef.current = false
5. metaSentRef.current = false
```

#### 4. ì—ëŸ¬ ì²˜ë¦¬
```javascript
// ê° ì •ë¦¬ ë‹¨ê³„ë¥¼ try-catchë¡œ ê°ì‹¸ê¸°
try {
  // Janus ì •ë¦¬
} catch (error) {
  console.error('Janus ì •ë¦¬ ì‹¤íŒ¨:', error);
  // ê³„ì† ì§„í–‰ (ë‹¤ìŒ ì •ë¦¬ ë‹¨ê³„ ì‹¤í–‰)
}

// ìµœì¢…ì ìœ¼ë¡œ ì‹¤íŒ¨í•´ë„ í˜ì´ì§€ ì´ë™
finally {
  navigate('/main');
}
```

### 5.5 ì„±ëŠ¥ ìµœì í™”

#### 1. useCallback ì‚¬ìš©
```javascript
// í‡´ì¥ í•¨ìˆ˜ëŠ” useCallbackìœ¼ë¡œ ë©”ëª¨ì´ì œì´ì…˜
const cleanupAndExit = useCallback(async () => {
  // ...
}, [dependencies]);
```

#### 2. ë¹„ë™ê¸° ì²˜ë¦¬
```javascript
// Janus leave ìš”ì²­ì€ Promiseë¡œ ì²˜ë¦¬
await new Promise((resolve) => {
  pluginHandleRef.current.send({ 
    message: { request: 'leave' },
    success: resolve,
    error: resolve
  });
  setTimeout(resolve, 500); // íƒ€ì„ì•„ì›ƒ
});
```

#### 3. ë³‘ë ¬ ì²˜ë¦¬ ê°€ëŠ¥í•œ ì‘ì—…
```javascript
// ë…ë¦½ì ì¸ ì‘ì—…ì€ ë³‘ë ¬ë¡œ ì‹¤í–‰
await Promise.all([
  cleanupJanus(),
  cleanupWebcam(),
  cleanupFastApi()
]);
```

---

## 6. ì˜ˆìƒ íš¨ê³¼

### 6.1 ì½”ë“œ í’ˆì§ˆ ê°œì„ 
- **ê°€ë…ì„± í–¥ìƒ**: 600ì¤„ â†’ 150-200ì¤„
- **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**: ë¡œì§ ë¶„ë¦¬ë¡œ ìˆ˜ì • ìš©ì´
- **ì¬ì‚¬ìš©ì„± í–¥ìƒ**: ê³µí†µ í›…ìœ¼ë¡œ ì½”ë“œ ì¬ì‚¬ìš©
- **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: ê° í›…ì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

### 6.2 ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- **ì•ˆì •ì„± í–¥ìƒ**: ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ë°©ì§€
- **ì‘ë‹µì„± í–¥ìƒ**: ë¹ ë¥¸ í˜ì´ì§€ ì „í™˜
- **ì¼ê´€ì„± í–¥ìƒ**: ëª¨ë“  í˜ì´ì§€ì—ì„œ ë™ì¼í•œ í‡´ì¥ ê²½í—˜

### 6.3 ê°œë°œ ìƒì‚°ì„± í–¥ìƒ
- **ì‹ ê·œ ê¸°ëŠ¥ ì¶”ê°€ ìš©ì´**: í›… ê¸°ë°˜ êµ¬ì¡°ë¡œ í™•ì¥ ì‰¬ì›€
- **ë²„ê·¸ ìˆ˜ì • ìš©ì´**: ë¡œì§ ë¶„ë¦¬ë¡œ ë””ë²„ê¹… ì‰¬ì›€
- **ì½”ë“œ ë¦¬ë·° ìš©ì´**: ì‘ì€ ë‹¨ìœ„ë¡œ ë¦¬ë·° ê°€ëŠ¥

---

## 7. ê²°ë¡ 

### í•µì‹¬ ìš”ì•½
1. **ê³µí†µ í‡´ì¥ í›… ìƒì„±**: useRoomExitìœ¼ë¡œ ì¤‘ë³µ ì½”ë“œ ì œê±°
2. **ê²Œì„ í˜ì´ì§€ í‡´ì¥ êµ¬í˜„**: ì™„ì „í•œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ë¡œì§ ì¶”ê°€
3. **ëŒ€ê¸°ë°© ë¦¬íŒ©í† ë§**: í›…ê³¼ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ë¡œ êµ¬ì¡° ê°œì„ 

### ğŸ”¥ ê°€ì¥ ì¤‘ìš”í•œ í¬ì¸íŠ¸
**ë°±ì—”ë“œì—ëŠ” ëª…ì‹œì ì¸ í‡´ì¥ APIê°€ ì—†ìŠµë‹ˆë‹¤!**

í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‹¨ìˆœíˆ `websocketService.disconnect()`ë§Œ í˜¸ì¶œí•˜ë©´:
- ë°±ì—”ë“œê°€ DISCONNECT ì´ë²¤íŠ¸ë¥¼ ìë™ ê°ì§€
- GameRoomLeaveServiceê°€ ìë™ìœ¼ë¡œ í‡´ì¥ ì²˜ë¦¬
- ì°¸ê°€ì ì •ë³´ ì‚­ì œ, ë°© ì¸ì› ê°ì†Œ, ìºì‹œ ì •ë¦¬
- ë°©ì¥ì´ë©´ ë°© ì¢…ë£Œ ë° ë‚¨ì€ ì°¸ê°€ì ì„¸ì…˜ ì •ë¦¬
- ë‹¤ë¥¸ ì°¸ê°€ìë“¤ì—ê²Œ ìë™ìœ¼ë¡œ ì•Œë¦¼ ì „ì†¡

**ëª¨ë“  ê²ƒì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤!**

ë”°ë¼ì„œ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ì‹œ:
```javascript
// âœ… ì˜¬ë°”ë¥¸ êµ¬í˜„
const cleanupAndExit = async () => {
  // 1. Janus ì •ë¦¬
  // 2. ì›¹ìº  ì •ë¦¬
  // 3. websocketService.disconnect() â­ ì´ê²ƒë§Œ!
  // 4. í˜ì´ì§€ ì´ë™
};

// âŒ ì˜ëª»ëœ êµ¬í˜„ (ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ)
const cleanupAndExit = async () => {
  await websocketService.leaveRoom(roomId); // ì´ëŸ° API ì—†ìŒ!
  websocketService.disconnect();
};
```

### ìš°ì„ ìˆœìœ„
1. **ì¦‰ì‹œ**: useRoomExit í›… + QuizGamePage í‡´ì¥ ë¡œì§
2. **ë‹¤ìŒ**: ëŒ€ê¸°ë°© WebSocket/Janus í›… ë¶„ë¦¬
3. **ì ì§„ì **: ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ ë° í…ŒìŠ¤íŠ¸ ì½”ë“œ

### ì˜ˆìƒ ì‘ì—… ì‹œê°„
- **Phase 1 (ê¸´ê¸‰)**: 3-5ì‹œê°„
- **Phase 2-3 (ì¤‘ìš”)**: 10-15ì‹œê°„
- **Phase 4 (ê°œì„ )**: 5-8ì‹œê°„
- **ì´í•©**: 18-28ì‹œê°„ (2-3ì¼)
