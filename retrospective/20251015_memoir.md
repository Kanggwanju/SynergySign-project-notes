# [SignBell 프로젝트] 2025-10-15 회고록

---

## 📝 작업 개요

* **작업일**: 2025.10.15
* **회고 작성자**: 강관주
* **팀 작업**: WebRTC 4인 테스트 결과 공유 및 퀴즈 기능 역할 분담 확정
* **개인 작업**: STOMP 기반 게임 방 입장 처리 및 브로드캐스트 기능 구현

---

## 👥 팀 미팅 및 작업

### 1. WebRTC 4인 연결 테스트 성공

고동현 님이 구축한 WebRTC 데모 페이지로 4인 연결 테스트를 성공적으로 완료했습니다. 1:N 통신 환경에서는 미디어 서버(Janus) 사용이 필수적임을 확인했고, 개발 기간 동안 기업용 Janus 서버를 활용하기로 결정했습니다.

### 2. 퀴즈 기능 역할 분담 확정

회의에서 퀴즈 기능의 역할을 명확히 분담했습니다:
* **강관주**: 게임 시작 전까지의 서버 로직 (방 입장/퇴장/준비) 및 WebSocket 설계
* **고동현 님**: 클라이언트 단의 WebRTC 기능 구현

역할이 명확해지면서 각자의 전문 영역에 집중할 수 있게 되었습니다.

---

## 👨‍💻 개인 작업

### STOMP 기반 게임 방 입장 처리 구현

WebSocket을 활용한 실시간 게임 방 입장 기능을 구현하고 PR을 작성했습니다.

**구현한 주요 기능**:

**1. DTO 추가 및 정리**
* `JoinRoomRequest`, `JoinRoomResponse`, `ParticipantResponse`, `ParticipantEventResponse` 추가

**2. Entity 편의 메서드 추가**
* `GameRoom.incrementParticipants()`, `decrementParticipants()` 추가

**3. Repository 최적화**
* JPQL fetch join 적용으로 N+1 문제 해결
* `findByGameRoom_Id`, `findByParticipant_Id`에서 즉시 로딩 적용

**4. Service 계층 (GameRoomJoinService)**
* 방 존재/상태 검증 (WAITING 상태만 입장 가능)
* 인원 제한 체크 (최대 4명)
* 중복 입장 방지
* 참가자 추가 및 방 상태 업데이트

**5. Controller 계층 (GameRoomJoinController)**
* STOMP 엔드포인트: `/app/room/{gameRoomId}/join`
* 개인 큐 응답: `/user/queue/room` (입장한 사용자에게만 방 전체 정보)
* 브로드캐스트: `/topic/room/{gameRoomId}/participant` (방 전체에 신규 참가자 알림)
* 에러 메시지 전송: `/user/queue/errors`

**6. 통합 테스트 작성**
* Repository 레벨 N+1 방지 검증
* Service 통합 테스트: 정상 입장, 방/사용자 미존재, 이미 시작된 방, 인원 초과, 타 방 참여 중 등
* Controller 통합 테스트: 개인 큐/브로드캐스트 메시지 검증, 에러 시나리오 검증

**PR 제출 (#23)**:
* 제목: `[Feat]: STOMP 기반 게임 방 입장 처리 및 브로드캐스트 추가`
* 7개 커밋으로 단계별 구현
* N+1 문제 해결, 메시징 구조 명세, 통합 테스트 포함

---

## 🤔 느낀점

> 14일에 고동현 님이 구축한 WebSocket 설정 위에서 실제 게임 방 입장 기능을 구현하니 실시간 통신의 흐름이 명확히 이해되었습니다. STOMP의 개인 큐와 브로드캐스트를 활용해 입장자에게는 방 전체 정보를, 방 전체에는 신규 참가자 알림을 보내는 구조가 생각보다 직관적이었습니다.
>
> Repository에 JPQL fetch join을 적용하면서 N+1 문제를 근본적으로 해결한 점이 만족스러웠습니다. 단순히 기능이 작동하는 것을 넘어 성능까지 고려한 설계가 중요하다는 것을 다시 느꼈습니다.
>
> 회의에서 역할 분담이 명확해진 것도 좋았습니다. 제가 게임 시작 전까지의 로직에 집중하고, 고동현 님이 클라이언트 WebRTC에 집중하니 중복 작업 없이 효율적으로 진행할 수 있을 것 같습니다. 이제 게임 시작 전의 전체 플로우(입장, 퇴장, 준비)를 완성하는 것이 목표입니다.

---

## ✅ 다음 계획

* **게임 방 퇴장 기능 구현**: WebSocket 기반 퇴장 처리 및 브로드캐스트
* **준비 상태 변경 기능 구현**: 참가자 준비 완료/취소 처리
* **게임 시작 로직 구현**: 모든 참가자 준비 완료 시 게임 시작
* **통합 테스트 지속 작성**: 각 기능별 테스트 커버리지 확보