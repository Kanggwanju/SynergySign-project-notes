# [SignBell 프로젝트] 2025-10-25 회고록

---

## 📝 작업 개요

* **작업일**: 2025.10.25
* **작성자**: 강관주
* **팀 작업**: (없음 – 주말 개별 작업일)
* **개인 작업**: 퀴즈 대기방 리팩토링 관련 PR 취소 결정, WebSocket 단일 세션 아키텍처 및 새로고침 대응 문서 작성

---

## 👨‍💻 개인 작업

### 1. 퀴즈 대기방 리팩토링 PR 취소

오전에는 **퀴즈 대기방 리팩토링 PR(#101)** 을 제출했지만,  
고동현 님이 퀴즈 게임 로직을 구현하면서 대기방 코드 일부를 수정하셨기 때문에  
제가 올린 PR을 그대로 병합하면 **충돌 및 작업 중복**이 발생할 수 있는 상황이었습니다.

고동현 님이 작업 중이던 브랜치를 확인해 보니,  
게임방 → 대기방 전환 흐름과 이벤트 구조가 일부 변경되고 있었고,  
제가 작성한 리팩토링 코드와 로직 방향이 맞물리지 않는 부분이 있었습니다.

> ⚖️ **결정:**  
> 당장은 제 PR을 병합하지 않고 **취소 처리(Closed)** 후,  
> 동현 님이 작업하신 코드가 병합된 이후에  
> 그 구조를 기반으로 다시 리팩토링을 진행하기로 결정했습니다.

이 결정으로 단기적으로는 작업이 늦춰지지만,  
코드 충돌을 최소화하고 이후 리팩토링이 더 깔끔하게 이어질 수 있을 것으로 판단했습니다.

---

### 2. WebSocket 단일 세션 아키텍처 문서 정리

📄 **문서명:** `20251025_WebSocket_단일세션아키텍처.md`

WebSocket 환경에서 한 사용자가 여러 탭으로 접속할 때  
발생할 수 있는 데이터 불일치 문제를 해결하기 위해  
“**단일 세션 (First-Come, First-Served) 정책**”의 구조와 동작 원리를 정리했습니다.

**핵심 요약:**
- 한 사용자당 **하나의 WebSocket 세션만 허용**
- `SingleSessionChannelInterceptor`에서 CONNECT 시 기존 세션 검증
- `UserSessionRegistry`로 사용자별 활성 세션 매핑 관리
- 중복 세션 감지 시 `DUPLICATE_SESSION` 에러 반환
- **기존 연결 보호 / 새 연결 차단** 원칙 적용
- 프론트엔드에서는 싱글톤 WebSocketService로 정책 일치

**주요 이점:**
- 데이터 일관성 보장 (한 사용자는 한 방에만 존재)
- 리소스 절감 (사용자당 1세션 유지)
- 보안 강화 (세션 하이재킹 방지)
- 비즈니스 로직 단순화 (퇴장 처리 단일화)

이 구조를 면접 대비용으로도 정리하여,  
“왜 단일 세션을 선택했는가”에 대한 기술적·비즈니스적 이유를 명확히 설명할 수 있도록 구성했습니다.

---

### 3. 퀴즈 대기방 새로고침 문제 분석 및 대응 문서 작성

📄 **문서명:** `20251025_퀴즈대기방새로고침.md`

퀴즈 대기방에서 **방장이 새로고침할 때 발생하는 오류**(“이미 시작된 방” 메시지, 재입장 불가 등)를 분석하고  
프론트엔드·백엔드 간 타이밍 불일치를 해결하기 위한 대응 방안을 문서로 정리했습니다.

**핵심 원인:**
- 백엔드 세션 정리는 정상적으로 작동하지만,  
  프론트엔드에서 `websocketService.disconnect()`가 호출되지 않아  
  브라우저가 여전히 연결 상태로 인식하는 문제 발생.

**해결 방향:**
- `handleError` 내에서 WebSocket 연결 명시적 정리 추가
- `useWaitingRoomWebSocket` 훅에 cleanup 로직 강화
- `AlertModal`로 UI 일관성 확보
- 필요 시 `RealTimeQuizSidebar`에서 프론트엔드 연결 상태도 함께 검증

**결과:**
- 새로고침 후 “이미 시작된 방” 오류 제거
- 방장 퇴장 시에도 참가자들이 정상적으로 방 종료 처리
- 세션 상태 불일치 문제 해소 및 UX 일관성 확보

이 문서는 단순한 버그 리포트가 아니라,  
**문제의 타이밍 흐름을 단계별로 시퀀스로 분석**한 점에서 큰 의미가 있습니다.  
이후 다른 WebSocket 기반 기능에도 참고할 수 있는 좋은 기술 자료가 되었습니다.

---

## 🤔 느낀점

> 오늘은 실제 기능 구현보다는 “정리와 판단”에 초점이 맞춰진 하루였습니다.  
> 코드보다 중요한 건 **협업의 타이밍**이라는 걸 다시 한번 느꼈습니다.  
> 무리하게 제 리팩토링을 병합하기보다는,  
> 팀 전체 구조가 안정된 후 다시 진행하는 게 더 현명한 선택이었습니다.
>
> 또, 단일 세션 아키텍처와 새로고침 대응 문서를 정리하면서  
> 실시간 시스템의 복잡한 타이밍 문제를 시각적으로 이해할 수 있었고,  
> 향후 비슷한 문제를 빠르게 진단할 수 있는 기반이 마련된 것 같습니다.

---

## ✅ 다음 계획

* **고동현 님의 퀴즈 게임 로직 PR 수용 후 리팩토링 재진행**
  - 구조 변경사항 분석 후 `useWaitingRoomWebSocket`, `useWaitingRoomJanus` 개선
* **WebSocket 안정성 검증**
  - 단일 세션 정책 + 새로고침 시나리오 종합 테스트
* **문서 보완**
  - 단일 세션 정책 및 새로고침 대응 문서에 테스트 로그 추가
