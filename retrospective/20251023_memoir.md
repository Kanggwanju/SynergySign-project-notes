# [SignBell 프로젝트] 2025-10-23 회고록

---

## 📝 작업 개요

* **작업일**: 2025.10.23
* **작성자**: 강관주
* **팀 작업**: 인증 정책 및 메인 페이지 기능 논의
* **개인 작업**: 실시간 퀴즈 대기방 참여 및 WebRTC 연동 기능 구현 (PR #75)

---

## 👥 팀 미팅 및 작업

### 1. 회의 요약

* **인증 정책:**
  - 토큰이 없는 사용자가 방 생성 또는 입장을 시도할 경우, 별도 알림 없이 로그인 페이지로 즉시 이동하는 정책으로 결정.
  - 로그인 유무를 기준으로 WebSocket 연결 가능 여부도 함께 검증하기로 함.

* **메인 페이지 개선:**
  - 전체 사용자 점수 기반 **랭킹 Top 10**을 표시하는 기능을 추가하기로 결정.
  - 디자인은 기존 레이아웃을 유지하며, UI를 깔끔하게 구성하는 방향으로 진행.

### 2. 담당자별 주요 계획
* **강관주:** 나가기 버튼 클릭 시 소켓 연결 해제 및 세션 삭제 처리 / 새로고침 시 WebSocket 세션 복구 방식 검토
* **고동현:** 실시간 퀴즈 진행 로직 개발 지속
* **송민재:** 마이페이지 및 랭킹 API 개발
* **신동준:** 메인 페이지 랭킹 UI 구현 및 PT 초안 구성
* **백승현:** FastAPI 모듈화 및 React 연동 작업

---

## 👨‍💻 개인 작업

### 1. [PR #75] 실시간 퀴즈 대기방 참여 및 WebRTC 연동 기능 구현

전날까지 진행했던 WebSocket 인증 및 참가자 로직을 기반으로,  
**실시간 대기방 동기화 + WebRTC 영상 송수신 기능**을 완성했습니다.

**주요 구현 내용**

#### 🧩 백엔드
- **Principal 기반 인증 체계 완성**
  - `GameRoomJoinController`, `GameRoomReadyController`에서 `Principal.getName()`으로 사용자 식별
  - null `Principal` 및 잘못된 형식 처리 로직 추가
  - 관련 통합 테스트 케이스 추가 및 검증

- **입장 로직 고도화**
  - `GameParticipantRepository.existsByParticipantAndGameRoom` 메서드로 중복 입장 방지
  - 중복 입장 시 현재 참가자 목록 반환
  - 방장 여부 확인 및 다중 방 입장 검증 로직 분리

- **DTO 개선**
  - `ReadyStatusRequest`에 `@JsonProperty("isReady")` 추가하여 직렬화/역직렬화 정확성 강화

#### 💻 프론트엔드
- **WebSocket 인프라 구축**
  - `@stomp/stompjs` 기반 `websocketService.js` 작성
  - 연결/구독/메시지 전송/해제 로직 통합 관리
  - 참가자 입장, 준비 상태, 방 이벤트를 실시간으로 송수신

- **대기방 실시간 동기화**
  - `QuizWaitingRoom` 컴포넌트에 WebSocket 연동
  - 참가자 입·퇴장 및 준비 상태 실시간 반영
  - 모든 참가자에게 변경 사항 브로드캐스트

- **WebRTC 영상 송수신 기능**
  - Janus Gateway 연동 및 VideoRoom 플러그인 사용
  - 로컬 스트림 publish + 원격 스트림 subscribe 구조 구현
  - 참가자 입·퇴장 시 자동 스트림 동기화 처리
  - UI 내 Janus 연결 상태 및 스트림 정보 표시

> 이 작업으로 대기방 단계에서의 **참가자 실시간 상호작용 및 영상 연결**이 정상적으로 이루어졌습니다.  
> 백엔드와의 WebSocket 흐름도 안정화되어, 이제 본격적인 게임 시작 이벤트를 연동할 수 있는 기반이 마련되었습니다.

---

## 🤔 느낀점

> 이번 작업을 통해 WebSocket과 WebRTC의 병행 구조를 실제로 구현해보며,  
> 실시간 통신의 복잡성을 직접 체감할 수 있었습니다.  
> 특히 참가자 입장/퇴장 시 스트림 동기화 로직을 정리하면서,  
> 백엔드 이벤트 구조가 얼마나 명확해야 프론트에서 예측 가능한 동작을 구현할 수 있는지를 느꼈습니다.
>
> 전날 리팩토링한 Principal 기반 인증 구조가 실제 연동 환경에서도 문제없이 동작해,  
> WebSocket 인증 흐름이 완전히 안정화된 점이 가장 큰 수확이었습니다.

---

## ✅ 다음 계획

* **대기방 완성도 향상**
  - 나가기 버튼 클릭 시 WebSocket 연결 해제 및 세션 삭제 처리
  - 새로고침 시 세션 복구 및 재입장 로직 테스트
* **게임 시작 로직 연동**
  - 고동현 님과 협업하여 WebSocket 기반 게임 시작 이벤트 연결
* **UI 개선**
  - 실시간 참가자 수 및 준비 상태 표시 시각화
  - Janus 연결 상태 시각 피드백 강화
