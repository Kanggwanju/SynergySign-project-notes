# [SignBell 프로젝트] 2025-10-24 회고록

---

## 📝 작업 개요

* **작업일**: 2025.10.24
* **작성자**: 강관주
* **팀 작업**: 전일 작업 공유 및 퀴즈 기능 안정화 점검
* **개인 작업**: 퀴즈 대기방 연결 해제 및 예외 처리 구현 (PR #84), Zustand 기반 인증 상태 관리 개선 (PR #88)

---

## 👥 팀 미팅 및 작업

### 1. 전일 작업 공유

* **고동현:** 게임 시작 프론트엔드 구현 중. FastAPI 연동 전 점수 계산 로직 준비.
* **송민재:** 약관 동의 상태 관리 버그 수정 진행 중.
* **강관주:** 퀴즈 대기방 퇴장 로직 구현 및 WebSocket 세션 해제 테스트 진행.
* **백승현:** React–FastAPI 연결 완료, Python WebSocket 리팩토링 및 S3 연동 완료.

### 2. 주요 논의 및 결정 사항
* 이번 주 주말까지 프론트엔드 주요 기능(대기방, 퀴즈 진행) 완료 목표.
* FastAPI 연결 병합 후 실시간 수어 퀴즈 개발 시작.

---

## 👨‍💻 개인 작업

### 1. [PR #84] 퀴즈 대기방 연결 해제 및 예외 상황 처리

대기방에서 발생할 수 있는 **모든 종료 시나리오(퇴장, 비정상 종료, 새로고침 등)** 에 대응하는 로직을 구현했습니다.

**주요 구현 내용**

#### ✅ 나가기 버튼 및 확인 모달
- 사용자가 명시적으로 방을 나갈 수 있는 **“나가기” 버튼** 추가
- `ConfirmModal`을 통한 확인 절차 후 안전한 리소스 정리 및 페이지 이동

#### ✅ 방 종료 알림 시스템
- `AlertModal`을 통한 **방장 퇴장 알림 UI** 구현
- 방장이 나가면 참가자에게 `"방장이 나가서 방이 종료되었습니다"` 메시지 표시
- 확인 시 리소스 정리 후 메인 페이지로 리다이렉트

#### ✅ 다중 경로 이벤트 처리
- 세 가지 경로(`/user/queue/room-closed`, `ROOM_CLOSED`, `PARTICIPANT_LEFT + roomClosed: true`)를 통한 **방 종료 감지 로직** 구축
- 이벤트 중복 발생 방지 및 상태 일관성 보장

#### ✅ 공통 리소스 정리 함수
- `cleanupAndExit()` 함수로 Janus/WebSocket/MediaStream 등 리소스 일괄 정리
- 순차적으로 Janus → 웹캠 → WebSocket 순서로 종료하여 안정성 확보

#### ✅ 비정상 종료 및 새로고침 감지
- `beforeunload` 이벤트 리스너를 통해 탭 닫기/새로고침 감지
- 즉시 Janus 및 스트림 정리 후 서버의 `onDisconnect` 자동 호출

> 이번 개선으로 대기방의 연결 해제 시나리오가 완전히 안정화되었고,  
> 중복 세션 방지 및 재입장 허용 로직이 정상적으로 동작함을 확인했습니다.

---

### 2. [PR #88] Zustand 연동으로 사용자 인증 및 상태 관리 로직 개선

기존의 임시 사용자 ID 기반 인증 로직을 제거하고,  
**Zustand 전역 상태 관리**로 실제 로그인 사용자 정보를 활용하도록 개선했습니다.

**핵심 변경 사항**
- `useAuthStore`를 통한 `user`, `isAuthenticated`, `hasCheckedAuth` 상태 관리
- localStorage persist로 새로고침 이후에도 인증 상태 유지
- 비로그인 사용자는 대기방 접근 시 `/main`으로 리다이렉트
- 기존 `useState` 기반 `myUserId` 제거 및 전역 `user.userId`로 대체
- WebSocket 및 Janus 연결 시 정확한 `userId` 전달 보장

**테스트 결과**
- 로그인 상태에서 입장 시 본인 표시 `(나)` 정상 노출
- 새로고침 후에도 인증 상태 유지 확인
- 비로그인 상태 접근 시 경고 후 `/main`으로 이동

> Zustand를 통한 인증 관리는 코드 일관성을 높였고,  
> 이후 WebSocket·WebRTC 전반에서 사용자 식별을 정확하게 처리할 수 있는 기반이 마련되었습니다.

---

## 🤔 느낀점

> 오늘은 “안정성 확보”에 초점이 맞춰진 하루였습니다.  
> 대기방에서 발생할 수 있는 모든 종료 시나리오를 실제로 테스트하면서,  
> WebSocket과 Janus 리소스가 의도대로 정리되는 것을 직접 확인할 수 있었습니다.
>
> 또한 Zustand를 도입하면서 프론트엔드의 인증 구조가 훨씬 명확해졌고,  
> 이후 세션 복구나 재입장 기능에서도 일관된 로직을 유지할 수 있을 것 같습니다.  
> 작은 개선이지만, 전체 시스템의 신뢰도를 높이는 중요한 전환점이었습니다.

---

## ✅ 다음 계획

* **퀴즈 대기방 리팩토링**
  - 대기방 상태 관리 및 WebSocket 이벤트 흐름 단순화
  - 컴포넌트 구조 정리 및 공통 훅(`useQuizRoom`)으로 로직 통합
* **퀴즈 진행 기능 연동**
  - 고동현 님과 협업하여 WebSocket 기반 게임 시작 이벤트 연동
