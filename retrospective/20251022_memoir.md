# [SignBell 프로젝트] 2025-10-22 회고록

---

## 📝 작업 개요

* **작업일**: 2025.10.22
* **작성자**: 강관주
* **팀 작업**: 전일 작업 공유 및 실시간 퀴즈 기능 단계별 진행 현황 점검
* **개인 작업**: 퀴즈 방 입장/준비 로직 리팩토링 및 WebSocket 인증 트러블슈팅 정리

---

## 👥 팀 미팅 및 작업

### 1. 전일 작업 공유

* **강관주:** 퀴즈 방 생성·조회 프론트엔드 구현 완료
* **백승현:** HTTPS 환경에서의 WebSocket 통신 및 FastAPI 연동 완료
* **송민재:** 약관 동의 UI 구현 완료
* **신동준:** 개인 수어 학습 UI 개발 진행 중
* **고동현:** 실시간 퀴즈 게임(시작~진행 로직) 구현 중

### 2. 결정 사항
* 강관주·백승현의 완료된 작업 코드 리뷰 후, 리뷰 내용 반영 후 메인 브랜치 병합 예정
* 각자 금일 액션 아이템 중심으로 작업 지속

---

## 👨‍💻 개인 작업

### 1. 퀴즈 방 관리 UI 및 API 연동 검수

전날(21일)에 올린 **[PR #70: 퀴즈 방 관리 UI 및 API 연동]**에 대해 팀장님 확인을 받았습니다.
- 방 목록 조회, 생성, 상세 조회, 입장 등 핵심 흐름이 정상 동작함을 검증받음
- WebSocket 세션 관리 및 중복 접속 방지 로직도 문제없이 작동
- UI/UX 개선 및 코드 일관성 측면에서도 긍정적인 피드백을 받음

이를 통해 실시간 퀴즈 로비 기능이 안정적으로 동작하는 것을 확인했습니다.

---

### 2. WebSocket 인증 트러블슈팅 및 로직 리팩토링

#### 🔎 문제 원인 분석
WebSocket 환경에서 `@AuthenticationPrincipal`이 `null`로 주입되는 문제를 발견했습니다.  
이는 STOMP 메시지 처리 시 Spring Security 필터 체인이 동작하지 않아  
`SecurityContextHolder`가 비어 있는 상태였기 때문입니다.

#### 🧩 해결 방향
- WebSocket에서는 `@AuthenticationPrincipal` 대신 `Principal` 객체를 직접 주입받아 사용하도록 변경
- Handshake 단계에서 쿠키 기반 인증(`CookieAuthHandshakeInterceptor`)으로 `Principal`을 세션에 등록

#### 🛠️ 적용 내역 (커밋 #75)
1. **방 입장 로직 수정 (`GameRoomJoinController`)**  
   → `@AuthenticationPrincipal` 제거, `Principal.getName()`을 이용한 사용자 식별로 변경
2. **중복 입장 처리 로직 추가 (`GameRoomJoinService`)**  
   → `existsByParticipantAndGameRoom` 메서드로 중복 입장 방지
3. **준비 상태 변경 로직 수정 (`GameRoomReadyController`)**  
   → `Principal` 기반으로 사용자 식별 및 예외 처리 강화
4. **DTO 개선 (`ReadyStatusRequest`)**  
   → `@JsonProperty("isReady")` 추가로 직렬화/역직렬화 시 필드 불일치 문제 해결

이 과정에서 통합 테스트와 메시징 호출 테스트도 보강하여,  
비정상 세션 또는 잘못된 사용자 요청에 대한 방어 로직을 완성했습니다.

---

### 3. 트러블슈팅 문서 작성

이번 이슈를 정리한 문서  
📄 **《WebSocket 환경에서 @AuthenticationPrincipal 주입 실패 원인 분석》** 을 작성했습니다.
- 문제 원인, 인증 흐름 비교, 해결 방법(Principal 기반 변경) 등을 시각 자료와 함께 정리
- 팀 내 공유를 통해 다른 WebSocket 관련 기능 개발 시 같은 문제가 반복되지 않도록 예방

> 문서의 핵심 결론:  
> WebSocket 환경에서는 `@AuthenticationPrincipal` 대신 `Principal`을 주입받는 것이 가장 안정적이다.

---

## 🤔 느낀점

> 이번 이슈를 통해 WebSocket 환경에서의 인증 구조를 깊게 이해할 수 있었습니다.  
> 특히 `SecurityContextHolder`와 `Principal`의 차이를 명확히 구분하게 되었고,  
> 실시간 통신 환경에서 인증 정보를 다루는 방식에 대한 인사이트를 얻었습니다.
>
> 또한 트러블슈팅 문서를 작성하며 팀 내 지식 공유의 중요성을 다시 느꼈습니다.  
> 단순히 버그를 고치는 것을 넘어, 왜 그런 현상이 발생했는지를 기록하는 것이  
> 팀 전체의 개발 효율을 높인다는 점을 체감한 하루였습니다.

---

## ✅ 다음 계획

* **실시간 퀴즈 프론트엔드 기능 확장**
  - 참가자 **레디/퇴장/삭제 로직** 구현
  - WebSocket 이벤트 흐름 테스트 및 예외 처리 강화
* **고동현 님과 협업**
  - 게임 시작 이후 로직(WebSocket 이벤트 핸들링) 연동 준비
